<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>LCOV - jsTestDriver.conf-coverage.dat - lib/require.js</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">lib</a> - require.js<span style="font-size: 80%;"> (source / <a href="require.js.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">jsTestDriver.conf-coverage.dat</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">274</td>
            <td class="headerCovTableEntry">644</td>
            <td class="headerCovTableEntryLo">42.5 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2012-07-11</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntryHi">-</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntryHi">-</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : /** vim: et:ts=4:sw=4:sts=4</a>
<span class="lineNum">       2 </span>                :            :  * @license RequireJS 1.0.4 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
<span class="lineNum">       3 </span>                :            :  * Available via the MIT or new BSD license.
<span class="lineNum">       4 </span>                :            :  * see: http://github.com/jrburke/requirejs for details
<span class="lineNum">       5 </span>                :            :  */
<span class="lineNum">       6 </span>                :            : /*jslint strict: false, plusplus: false, sub: true */
<span class="lineNum">       7 </span>                :            : /*global window: false, navigator: false, document: false, importScripts: false,
<span class="lineNum">       8 </span>                :            :   jQuery: false, clearInterval: false, setInterval: false, self: false,
<span class="lineNum">       9 </span>                :            :   setTimeout: false, opera: false */
<span class="lineNum">      10 </span>                :            : 
<span class="lineNum">      11 </span>                :<span class="lineCov">          1 : var requirejs, require, define;</span>
<span class="lineNum">      12 </span>                :<span class="lineCov">          1 : (function () {</span>
<span class="lineNum">      13 </span>                :            :     //Change this version number for each release.
<span class="lineNum">      14 </span>                :<span class="lineCov">          1 :     var version = &quot;1.0.4&quot;,</span>
<span class="lineNum">      15 </span>                :            :         commentRegExp = /(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,
<span class="lineNum">      16 </span>                :            :         cjsRequireRegExp = /require\(\s*[&quot;']([^'&quot;\s]+)[&quot;']\s*\)/g,
<span class="lineNum">      17 </span>                :            :         currDirRegExp = /^\.\//,
<span class="lineNum">      18 </span>                :            :         jsSuffixRegExp = /\.js$/,
<span class="lineNum">      19 </span>                :            :         ostring = Object.prototype.toString,
<span class="lineNum">      20 </span>                :            :         ap = Array.prototype,
<span class="lineNum">      21 </span>                :            :         aps = ap.slice,
<span class="lineNum">      22 </span>                :            :         apsp = ap.splice,
<span class="lineNum">      23 </span>                :            :         isBrowser = !!(typeof window !== &quot;undefined&quot; &amp;&amp; navigator &amp;&amp; document),
<span class="lineNum">      24 </span>                :            :         isWebWorker = !isBrowser &amp;&amp; typeof importScripts !== &quot;undefined&quot;,
<span class="lineNum">      25 </span>                :            :         //PS3 indicates loaded and complete, but need to wait for complete
<span class="lineNum">      26 </span>                :            :         //specifically. Sequence is &quot;loading&quot;, &quot;loaded&quot;, execution,
<span class="lineNum">      27 </span>                :            :         // then &quot;complete&quot;. The UA check is unfortunate, but not sure how
<span class="lineNum">      28 </span>                :            :         //to feature test w/o causing perf issues.
<span class="lineNum">      29 </span>                :            :         readyRegExp = isBrowser &amp;&amp; navigator.platform === 'PLAYSTATION 3' ?
<span class="lineNum">      30 </span>                :            :                       /^complete$/ : /^(complete|loaded)$/,
<span class="lineNum">      31 </span>                :            :         defContextName = &quot;_&quot;,
<span class="lineNum">      32 </span>                :            :         //Oh the tragedy, detecting opera. See the usage of isOpera for reason.
<span class="lineNum">      33 </span>                :            :         isOpera = typeof opera !== &quot;undefined&quot; &amp;&amp; opera.toString() === &quot;[object Opera]&quot;,
<span class="lineNum">      34 </span>                :            :         empty = {},
<span class="lineNum">      35 </span>                :            :         contexts = {},
<span class="lineNum">      36 </span>                :            :         globalDefQueue = [],
<span class="lineNum">      37 </span>                :            :         interactiveScript = null,
<span class="lineNum">      38 </span>                :            :         checkLoadedDepth = 0,
<span class="lineNum">      39 </span>                :            :         useInteractive = false,
<span class="lineNum">      40 </span>                :            :         req, cfg = {}, currentlyAddingScript, s, head, baseElement, scripts, script,
<span class="lineNum">      41 </span>                :            :         src, subPath, mainScript, dataMain, i, ctx, jQueryCheck, checkLoadedTimeoutId;
<span class="lineNum">      42 </span>                :            : 
<span class="lineNum">      43 </span>                :<span class="lineCov">          1 :     function isFunction(it) {</span>
<span class="lineNum">      44 </span>                :<span class="lineCov">          9 :         return ostring.call(it) === &quot;[object Function]&quot;;</span>
<span class="lineNum">      45 </span>                :            :     }
<span class="lineNum">      46 </span>                :            : 
<span class="lineNum">      47 </span>                :<span class="lineCov">          1 :     function isArray(it) {</span>
<span class="lineNum">      48 </span>                :<span class="lineCov">         19 :         return ostring.call(it) === &quot;[object Array]&quot;;</span>
<span class="lineNum">      49 </span>                :            :     }
<span class="lineNum">      50 </span>                :            : 
<span class="lineNum">      51 </span>                :            :     /**
<span class="lineNum">      52 </span>                :            :      * Simple function to mix in properties from source into target,
<span class="lineNum">      53 </span>                :            :      * but only if target does not already have a property of the same name.
<span class="lineNum">      54 </span>                :            :      * This is not robust in IE for transferring methods that match
<span class="lineNum">      55 </span>                :            :      * Object.prototype names, but the uses of mixin here seem unlikely to
<span class="lineNum">      56 </span>                :            :      * trigger a problem related to that.
<span class="lineNum">      57 </span>                :            :      */
<span class="lineNum">      58 </span>                :<span class="lineCov">          1 :     function mixin(target, source, force) {</span>
<span class="lineNum">      59 </span>                :<span class="lineCov">          1 :         for (var prop in source) {</span>
<span class="lineNum">      60 </span>                :<span class="lineNoCov">          0 :             if (!(prop in empty) &amp;&amp; (!(prop in target) || force)) {</span>
<span class="lineNum">      61 </span>                :<span class="lineNoCov">          0 :                 target[prop] = source[prop];</span>
<span class="lineNum">      62 </span>                :            :             }
<span class="lineNum">      63 </span>                :            :         }
<span class="lineNum">      64 </span>                :<span class="lineCov">          1 :         return req;</span>
<span class="lineNum">      65 </span>                :            :     }
<span class="lineNum">      66 </span>                :            : 
<span class="lineNum">      67 </span>                :            :     /**
<span class="lineNum">      68 </span>                :            :      * Constructs an error with a pointer to an URL with more information.
<span class="lineNum">      69 </span>                :            :      * @param {String} id the error ID that maps to an ID on a web page.
<span class="lineNum">      70 </span>                :            :      * @param {String} message human readable error.
<span class="lineNum">      71 </span>                :            :      * @param {Error} [err] the original error, if there is one.
<span class="lineNum">      72 </span>                :            :      *
<span class="lineNum">      73 </span>                :            :      * @returns {Error}
<span class="lineNum">      74 </span>                :            :      */
<span class="lineNum">      75 </span>                :<span class="lineCov">          1 :     function makeError(id, msg, err) {</span>
<span class="lineNum">      76 </span>                :<span class="lineCov">          2 :         var e = new Error(msg + '\nhttp://requirejs.org/docs/errors.html#' + id);</span>
<span class="lineNum">      77 </span>                :<span class="lineCov">          2 :         if (err) {</span>
<span class="lineNum">      78 </span>                :<span class="lineNoCov">          0 :             e.originalError = err;</span>
<span class="lineNum">      79 </span>                :            :         }
<span class="lineNum">      80 </span>                :<span class="lineCov">          2 :         return e;</span>
<span class="lineNum">      81 </span>                :            :     }
<span class="lineNum">      82 </span>                :            : 
<span class="lineNum">      83 </span>                :            :     /**
<span class="lineNum">      84 </span>                :            :      * Used to set up package paths from a packagePaths or packages config object.
<span class="lineNum">      85 </span>                :            :      * @param {Object} pkgs the object to store the new package config
<span class="lineNum">      86 </span>                :            :      * @param {Array} currentPackages an array of packages to configure
<span class="lineNum">      87 </span>                :            :      * @param {String} [dir] a prefix dir to use.
<span class="lineNum">      88 </span>                :            :      */
<span class="lineNum">      89 </span>                :<span class="lineCov">          1 :     function configurePackageDir(pkgs, currentPackages, dir) {</span>
<span class="lineNum">      90 </span>                :<span class="lineNoCov">          0 :         var i, location, pkgObj;</span>
<span class="lineNum">      91 </span>                :            : 
<span class="lineNum">      92 </span>                :<span class="lineNoCov">          0 :         for (i = 0; (pkgObj = currentPackages[i]); i++) {</span>
<span class="lineNum">      93 </span>                :<span class="lineNoCov">          0 :             pkgObj = typeof pkgObj === &quot;string&quot; ? { name: pkgObj } : pkgObj;</span>
<span class="lineNum">      94 </span>                :<span class="lineNoCov">          0 :             location = pkgObj.location;</span>
<span class="lineNum">      95 </span>                :            : 
<span class="lineNum">      96 </span>                :            :             //Add dir to the path, but avoid paths that start with a slash
<span class="lineNum">      97 </span>                :            :             //or have a colon (indicates a protocol)
<span class="lineNum">      98 </span>                :<span class="lineNoCov">          0 :             if (dir &amp;&amp; (!location || (location.indexOf(&quot;/&quot;) !== 0 &amp;&amp; location.indexOf(&quot;:&quot;) === -1))) {</span>
<span class="lineNum">      99 </span>                :<span class="lineNoCov">          0 :                 location = dir + &quot;/&quot; + (location || pkgObj.name);</span>
<span class="lineNum">     100 </span>                :            :             }
<span class="lineNum">     101 </span>                :            : 
<span class="lineNum">     102 </span>                :            :             //Create a brand new object on pkgs, since currentPackages can
<span class="lineNum">     103 </span>                :            :             //be passed in again, and config.pkgs is the internal transformed
<span class="lineNum">     104 </span>                :            :             //state for all package configs.
<span class="lineNum">     105 </span>                :<span class="lineNoCov">          0 :             pkgs[pkgObj.name] = {</span>
<span class="lineNum">     106 </span>                :            :                 name: pkgObj.name,
<span class="lineNum">     107 </span>                :            :                 location: location || pkgObj.name,
<span class="lineNum">     108 </span>                :            :                 //Remove leading dot in main, so main paths are normalized,
<span class="lineNum">     109 </span>                :            :                 //and remove any trailing .js, since different package
<span class="lineNum">     110 </span>                :            :                 //envs have different conventions: some use a module name,
<span class="lineNum">     111 </span>                :            :                 //some use a file name.
<span class="lineNum">     112 </span>                :            :                 main: (pkgObj.main || &quot;main&quot;)
<span class="lineNum">     113 </span>                :            :                       .replace(currDirRegExp, '')
<span class="lineNum">     114 </span>                :            :                       .replace(jsSuffixRegExp, '')
<span class="lineNum">     115 </span>                :            :             };
<span class="lineNum">     116 </span>                :            :         }
<span class="lineNum">     117 </span>                :            :     }
<span class="lineNum">     118 </span>                :            : 
<span class="lineNum">     119 </span>                :            :     /**
<span class="lineNum">     120 </span>                :            :      * jQuery 1.4.3-1.5.x use a readyWait/ready() pairing to hold DOM
<span class="lineNum">     121 </span>                :            :      * ready callbacks, but jQuery 1.6 supports a holdReady() API instead.
<span class="lineNum">     122 </span>                :            :      * At some point remove the readyWait/ready() support and just stick
<span class="lineNum">     123 </span>                :            :      * with using holdReady.
<span class="lineNum">     124 </span>                :            :      */
<span class="lineNum">     125 </span>                :<span class="lineCov">          1 :     function jQueryHoldReady($, shouldHold) {</span>
<span class="lineNum">     126 </span>                :<span class="lineNoCov">          0 :         if ($.holdReady) {</span>
<span class="lineNum">     127 </span>                :<span class="lineNoCov">          0 :             $.holdReady(shouldHold);</span>
<span class="lineNum">     128 </span>                :<span class="lineNoCov">          0 :         } else if (shouldHold) {</span>
<span class="lineNum">     129 </span>                :<span class="lineNoCov">          0 :             $.readyWait += 1;</span>
<span class="lineNum">     130 </span>                :            :         } else {
<span class="lineNum">     131 </span>                :<span class="lineNoCov">          0 :             $.ready(true);</span>
<span class="lineNum">     132 </span>                :            :         }
<span class="lineNum">     133 </span>                :            :     }
<span class="lineNum">     134 </span>                :            : 
<span class="lineNum">     135 </span>                :<span class="lineCov">          1 :     if (typeof define !== &quot;undefined&quot;) {</span>
<span class="lineNum">     136 </span>                :            :         //If a define is already in play via another AMD loader,
<span class="lineNum">     137 </span>                :            :         //do not overwrite.
<span class="lineNum">     138 </span>                :<span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     139 </span>                :            :     }
<span class="lineNum">     140 </span>                :            : 
<span class="lineNum">     141 </span>                :<span class="lineCov">          1 :     if (typeof requirejs !== &quot;undefined&quot;) {</span>
<span class="lineNum">     142 </span>                :<span class="lineNoCov">          0 :         if (isFunction(requirejs)) {</span>
<span class="lineNum">     143 </span>                :            :             //Do not overwrite and existing requirejs instance.
<span class="lineNum">     144 </span>                :<span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     145 </span>                :            :         } else {
<span class="lineNum">     146 </span>                :<span class="lineNoCov">          0 :             cfg = requirejs;</span>
<span class="lineNum">     147 </span>                :<span class="lineNoCov">          0 :             requirejs = undefined;</span>
<span class="lineNum">     148 </span>                :            :         }
<span class="lineNum">     149 </span>                :            :     }
<span class="lineNum">     150 </span>                :            : 
<span class="lineNum">     151 </span>                :            :     //Allow for a require config object
<span class="lineNum">     152 </span>                :<span class="lineCov">          1 :     if (typeof require !== &quot;undefined&quot; &amp;&amp; !isFunction(require)) {</span>
<span class="lineNum">     153 </span>                :            :         //assume it is a config object.
<span class="lineNum">     154 </span>                :<span class="lineNoCov">          0 :         cfg = require;</span>
<span class="lineNum">     155 </span>                :<span class="lineNoCov">          0 :         require = undefined;</span>
<span class="lineNum">     156 </span>                :            :     }
<span class="lineNum">     157 </span>                :            : 
<span class="lineNum">     158 </span>                :            :     /**
<span class="lineNum">     159 </span>                :            :      * Creates a new context for use in require and define calls.
<span class="lineNum">     160 </span>                :            :      * Handle most of the heavy lifting. Do not want to use an object
<span class="lineNum">     161 </span>                :            :      * with prototype here to avoid using &quot;this&quot; in require, in case it
<span class="lineNum">     162 </span>                :            :      * needs to be used in more super secure envs that do not want this.
<span class="lineNum">     163 </span>                :            :      * Also there should not be that many contexts in the page. Usually just
<span class="lineNum">     164 </span>                :            :      * one for the default context, but could be extra for multiversion cases
<span class="lineNum">     165 </span>                :            :      * or if a package needs a special context for a dependency that conflicts
<span class="lineNum">     166 </span>                :            :      * with the standard context.
<span class="lineNum">     167 </span>                :            :      */
<span class="lineNum">     168 </span>                :<span class="lineCov">          1 :     function newContext(contextName) {</span>
<span class="lineNum">     169 </span>                :<span class="lineCov">          1 :         var context, resume,</span>
<span class="lineNum">     170 </span>                :            :             config = {
<span class="lineNum">     171 </span>                :            :                 waitSeconds: 7,
<span class="lineNum">     172 </span>                :            :                 baseUrl: &quot;./&quot;,
<span class="lineNum">     173 </span>                :            :                 paths: {},
<span class="lineNum">     174 </span>                :            :                 pkgs: {},
<span class="lineNum">     175 </span>                :            :                 catchError: {}
<span class="lineNum">     176 </span>                :            :             },
<span class="lineNum">     177 </span>                :            :             defQueue = [],
<span class="lineNum">     178 </span>                :            :             specified = {
<span class="lineNum">     179 </span>                :            :                 &quot;require&quot;: true,
<span class="lineNum">     180 </span>                :            :                 &quot;exports&quot;: true,
<span class="lineNum">     181 </span>                :            :                 &quot;module&quot;: true
<span class="lineNum">     182 </span>                :            :             },
<span class="lineNum">     183 </span>                :            :             urlMap = {},
<span class="lineNum">     184 </span>                :            :             defined = {},
<span class="lineNum">     185 </span>                :            :             loaded = {},
<span class="lineNum">     186 </span>                :            :             waiting = {},
<span class="lineNum">     187 </span>                :            :             waitAry = [],
<span class="lineNum">     188 </span>                :            :             urlFetched = {},
<span class="lineNum">     189 </span>                :            :             managerCounter = 0,
<span class="lineNum">     190 </span>                :            :             managerCallbacks = {},
<span class="lineNum">     191 </span>                :            :             plugins = {},
<span class="lineNum">     192 </span>                :            :             //Used to indicate which modules in a build scenario
<span class="lineNum">     193 </span>                :            :             //need to be full executed.
<span class="lineNum">     194 </span>                :            :             needFullExec = {},
<span class="lineNum">     195 </span>                :            :             fullExec = {},
<span class="lineNum">     196 </span>                :            :             resumeDepth = 0;
<span class="lineNum">     197 </span>                :            : 
<span class="lineNum">     198 </span>                :            :         /**
<span class="lineNum">     199 </span>                :            :          * Trims the . and .. from an array of path segments.
<span class="lineNum">     200 </span>                :            :          * It will keep a leading path segment if a .. will become
<span class="lineNum">     201 </span>                :            :          * the first path segment, to help with module name lookups,
<span class="lineNum">     202 </span>                :            :          * which act like paths, but can be remapped. But the end result,
<span class="lineNum">     203 </span>                :            :          * all paths that use this function should look normalized.
<span class="lineNum">     204 </span>                :            :          * NOTE: this method MODIFIES the input array.
<span class="lineNum">     205 </span>                :            :          * @param {Array} ary the array of path segments.
<span class="lineNum">     206 </span>                :            :          */
<span class="lineNum">     207 </span>                :<span class="lineCov">          1 :         function trimDots(ary) {</span>
<span class="lineNum">     208 </span>                :<span class="lineNoCov">          0 :             var i, part;</span>
<span class="lineNum">     209 </span>                :<span class="lineNoCov">          0 :             for (i = 0; (part = ary[i]); i++) {</span>
<span class="lineNum">     210 </span>                :<span class="lineNoCov">          0 :                 if (part === &quot;.&quot;) {</span>
<span class="lineNum">     211 </span>                :<span class="lineNoCov">          0 :                     ary.splice(i, 1);</span>
<span class="lineNum">     212 </span>                :<span class="lineNoCov">          0 :                     i -= 1;</span>
<span class="lineNum">     213 </span>                :<span class="lineNoCov">          0 :                 } else if (part === &quot;..&quot;) {</span>
<span class="lineNum">     214 </span>                :<span class="lineNoCov">          0 :                     if (i === 1 &amp;&amp; (ary[2] === '..' || ary[0] === '..')) {</span>
<span class="lineNum">     215 </span>                :            :                         //End of the line. Keep at least one non-dot
<span class="lineNum">     216 </span>                :            :                         //path segment at the front so it can be mapped
<span class="lineNum">     217 </span>                :            :                         //correctly to disk. Otherwise, there is likely
<span class="lineNum">     218 </span>                :            :                         //no path mapping for a path starting with '..'.
<span class="lineNum">     219 </span>                :            :                         //This can still fail, but catches the most reasonable
<span class="lineNum">     220 </span>                :            :                         //uses of ..
<span class="lineNum">     221 </span>                :<span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     222 </span>                :<span class="lineNoCov">          0 :                     } else if (i &gt; 0) {</span>
<span class="lineNum">     223 </span>                :<span class="lineNoCov">          0 :                         ary.splice(i - 1, 2);</span>
<span class="lineNum">     224 </span>                :<span class="lineNoCov">          0 :                         i -= 2;</span>
<span class="lineNum">     225 </span>                :            :                     }
<span class="lineNum">     226 </span>                :            :                 }
<span class="lineNum">     227 </span>                :            :             }
<span class="lineNum">     228 </span>                :            :         }
<span class="lineNum">     229 </span>                :            : 
<span class="lineNum">     230 </span>                :            :         /**
<span class="lineNum">     231 </span>                :            :          * Given a relative module name, like ./something, normalize it to
<span class="lineNum">     232 </span>                :            :          * a real name that can be mapped to a path.
<span class="lineNum">     233 </span>                :            :          * @param {String} name the relative name
<span class="lineNum">     234 </span>                :            :          * @param {String} baseName a real name that the name arg is relative
<span class="lineNum">     235 </span>                :            :          * to.
<span class="lineNum">     236 </span>                :            :          * @returns {String} normalized name
<span class="lineNum">     237 </span>                :            :          */
<span class="lineNum">     238 </span>                :<span class="lineCov">          1 :         function normalize(name, baseName) {</span>
<span class="lineNum">     239 </span>                :<span class="lineCov">          5 :             var pkgName, pkgConfig;</span>
<span class="lineNum">     240 </span>                :            : 
<span class="lineNum">     241 </span>                :            :             //Adjust any relative paths.
<span class="lineNum">     242 </span>                :<span class="lineCov">          5 :             if (name &amp;&amp; name.charAt(0) === &quot;.&quot;) {</span>
<span class="lineNum">     243 </span>                :            :                 //If have a base name, try to normalize against it,
<span class="lineNum">     244 </span>                :            :                 //otherwise, assume it is a top-level require that will
<span class="lineNum">     245 </span>                :            :                 //be relative to baseUrl in the end.
<span class="lineNum">     246 </span>                :<span class="lineNoCov">          0 :                 if (baseName) {</span>
<span class="lineNum">     247 </span>                :<span class="lineNoCov">          0 :                     if (config.pkgs[baseName]) {</span>
<span class="lineNum">     248 </span>                :            :                         //If the baseName is a package name, then just treat it as one
<span class="lineNum">     249 </span>                :            :                         //name to concat the name with.
<span class="lineNum">     250 </span>                :<span class="lineNoCov">          0 :                         baseName = [baseName];</span>
<span class="lineNum">     251 </span>                :            :                     } else {
<span class="lineNum">     252 </span>                :            :                         //Convert baseName to array, and lop off the last part,
<span class="lineNum">     253 </span>                :            :                         //so that . matches that &quot;directory&quot; and not name of the baseName's
<span class="lineNum">     254 </span>                :            :                         //module. For instance, baseName of &quot;one/two/three&quot;, maps to
<span class="lineNum">     255 </span>                :            :                         //&quot;one/two/three.js&quot;, but we want the directory, &quot;one/two&quot; for
<span class="lineNum">     256 </span>                :            :                         //this normalization.
<span class="lineNum">     257 </span>                :<span class="lineNoCov">          0 :                         baseName = baseName.split(&quot;/&quot;);</span>
<span class="lineNum">     258 </span>                :<span class="lineNoCov">          0 :                         baseName = baseName.slice(0, baseName.length - 1);</span>
<span class="lineNum">     259 </span>                :            :                     }
<span class="lineNum">     260 </span>                :            : 
<span class="lineNum">     261 </span>                :<span class="lineNoCov">          0 :                     name = baseName.concat(name.split(&quot;/&quot;));</span>
<span class="lineNum">     262 </span>                :<span class="lineNoCov">          0 :                     trimDots(name);</span>
<span class="lineNum">     263 </span>                :            : 
<span class="lineNum">     264 </span>                :            :                     //Some use of packages may use a . path to reference the
<span class="lineNum">     265 </span>                :            :                     //&quot;main&quot; module name, so normalize for that.
<span class="lineNum">     266 </span>                :<span class="lineNoCov">          0 :                     pkgConfig = config.pkgs[(pkgName = name[0])];</span>
<span class="lineNum">     267 </span>                :<span class="lineNoCov">          0 :                     name = name.join(&quot;/&quot;);</span>
<span class="lineNum">     268 </span>                :<span class="lineNoCov">          0 :                     if (pkgConfig &amp;&amp; name === pkgName + '/' + pkgConfig.main) {</span>
<span class="lineNum">     269 </span>                :<span class="lineNoCov">          0 :                         name = pkgName;</span>
<span class="lineNum">     270 </span>                :            :                     }
<span class="lineNum">     271 </span>                :<span class="lineNoCov">          0 :                 } else if (name.indexOf(&quot;./&quot;) === 0) {</span>
<span class="lineNum">     272 </span>                :            :                     // No baseName, so this is ID is resolved relative
<span class="lineNum">     273 </span>                :            :                     // to baseUrl, pull off the leading dot.
<span class="lineNum">     274 </span>                :<span class="lineNoCov">          0 :                     name = name.substring(2);</span>
<span class="lineNum">     275 </span>                :            :                 }
<span class="lineNum">     276 </span>                :            :             }
<span class="lineNum">     277 </span>                :<span class="lineCov">          5 :             return name;</span>
<span class="lineNum">     278 </span>                :            :         }
<span class="lineNum">     279 </span>                :            : 
<span class="lineNum">     280 </span>                :            :         /**
<span class="lineNum">     281 </span>                :            :          * Creates a module mapping that includes plugin prefix, module
<span class="lineNum">     282 </span>                :            :          * name, and path. If parentModuleMap is provided it will
<span class="lineNum">     283 </span>                :            :          * also normalize the name via require.normalize()
<span class="lineNum">     284 </span>                :            :          *
<span class="lineNum">     285 </span>                :            :          * @param {String} name the module name
<span class="lineNum">     286 </span>                :            :          * @param {String} [parentModuleMap] parent module map
<span class="lineNum">     287 </span>                :            :          * for the module name, used to resolve relative names.
<span class="lineNum">     288 </span>                :            :          *
<span class="lineNum">     289 </span>                :            :          * @returns {Object}
<span class="lineNum">     290 </span>                :            :          */
<span class="lineNum">     291 </span>                :<span class="lineCov">          1 :         function makeModuleMap(name, parentModuleMap) {</span>
<span class="lineNum">     292 </span>                :<span class="lineCov">          5 :             var index = name ? name.indexOf(&quot;!&quot;) : -1,</span>
<span class="lineNum">     293 </span>                :            :                 prefix = null,
<span class="lineNum">     294 </span>                :            :                 parentName = parentModuleMap ? parentModuleMap.name : null,
<span class="lineNum">     295 </span>                :            :                 originalName = name,
<span class="lineNum">     296 </span>                :            :                 normalizedName, url, pluginModule;
<span class="lineNum">     297 </span>                :            : 
<span class="lineNum">     298 </span>                :<span class="lineCov">          5 :             if (index !== -1) {</span>
<span class="lineNum">     299 </span>                :<span class="lineNoCov">          0 :                 prefix = name.substring(0, index);</span>
<span class="lineNum">     300 </span>                :<span class="lineNoCov">          0 :                 name = name.substring(index + 1, name.length);</span>
<span class="lineNum">     301 </span>                :            :             }
<span class="lineNum">     302 </span>                :            : 
<span class="lineNum">     303 </span>                :<span class="lineCov">          5 :             if (prefix) {</span>
<span class="lineNum">     304 </span>                :<span class="lineNoCov">          0 :                 prefix = normalize(prefix, parentName);</span>
<span class="lineNum">     305 </span>                :            :             }
<span class="lineNum">     306 </span>                :            : 
<span class="lineNum">     307 </span>                :            :             //Account for relative paths if there is a base name.
<span class="lineNum">     308 </span>                :<span class="lineCov">          5 :             if (name) {</span>
<span class="lineNum">     309 </span>                :<span class="lineCov">          3 :                 if (prefix) {</span>
<span class="lineNum">     310 </span>                :<span class="lineNoCov">          0 :                     pluginModule = defined[prefix];</span>
<span class="lineNum">     311 </span>                :<span class="lineNoCov">          0 :                     if (pluginModule &amp;&amp; pluginModule.normalize) {</span>
<span class="lineNum">     312 </span>                :            :                         //Plugin is loaded, use its normalize method.
<span class="lineNum">     313 </span>                :<span class="lineNoCov">          0 :                         normalizedName = pluginModule.normalize(name, function (name) {</span>
<span class="lineNum">     314 </span>                :<span class="lineNoCov">          0 :                             return normalize(name, parentName);</span>
<span class="lineNum">     315 </span>                :            :                         });
<span class="lineNum">     316 </span>                :            :                     } else {
<span class="lineNum">     317 </span>                :<span class="lineNoCov">          0 :                         normalizedName = normalize(name, parentName);</span>
<span class="lineNum">     318 </span>                :            :                     }
<span class="lineNum">     319 </span>                :            :                 } else {
<span class="lineNum">     320 </span>                :            :                     //A regular module.
<span class="lineNum">     321 </span>                :<span class="lineCov">          3 :                     normalizedName = normalize(name, parentName);</span>
<span class="lineNum">     322 </span>                :            : 
<span class="lineNum">     323 </span>                :<span class="lineCov">          3 :                     url = urlMap[normalizedName];</span>
<span class="lineNum">     324 </span>                :<span class="lineCov">          3 :                     if (!url) {</span>
<span class="lineNum">     325 </span>                :            :                         //Calculate url for the module, if it has a name.
<span class="lineNum">     326 </span>                :            :                         //Use name here since nameToUrl also calls normalize,
<span class="lineNum">     327 </span>                :            :                         //and for relative names that are outside the baseUrl
<span class="lineNum">     328 </span>                :            :                         //this causes havoc. Was thinking of just removing
<span class="lineNum">     329 </span>                :            :                         //parentModuleMap to avoid extra normalization, but
<span class="lineNum">     330 </span>                :            :                         //normalize() still does a dot removal because of
<span class="lineNum">     331 </span>                :            :                         //issue #142, so just pass in name here and redo
<span class="lineNum">     332 </span>                :            :                         //the normalization. Paths outside baseUrl are just
<span class="lineNum">     333 </span>                :            :                         //messy to support.
<span class="lineNum">     334 </span>                :<span class="lineCov">          2 :                         url = context.nameToUrl(name, null, parentModuleMap);</span>
<span class="lineNum">     335 </span>                :            : 
<span class="lineNum">     336 </span>                :            :                         //Store the URL mapping for later.
<span class="lineNum">     337 </span>                :<span class="lineCov">          2 :                         urlMap[normalizedName] = url;</span>
<span class="lineNum">     338 </span>                :            :                     }
<span class="lineNum">     339 </span>                :            :                 }
<span class="lineNum">     340 </span>                :            :             }
<span class="lineNum">     341 </span>                :            : 
<span class="lineNum">     342 </span>                :<span class="lineCov">          5 :             return {</span>
<span class="lineNum">     343 </span>                :            :                 prefix: prefix,
<span class="lineNum">     344 </span>                :            :                 name: normalizedName,
<span class="lineNum">     345 </span>                :            :                 parentMap: parentModuleMap,
<span class="lineNum">     346 </span>                :            :                 url: url,
<span class="lineNum">     347 </span>                :            :                 originalName: originalName,
<span class="lineNum">     348 </span>                :            :                 fullName: prefix ? prefix + &quot;!&quot; + (normalizedName || '') : normalizedName
<span class="lineNum">     349 </span>                :            :             };
<span class="lineNum">     350 </span>                :            :         }
<span class="lineNum">     351 </span>                :            : 
<span class="lineNum">     352 </span>                :            :         /**
<span class="lineNum">     353 </span>                :            :          * Determine if priority loading is done. If so clear the priorityWait
<span class="lineNum">     354 </span>                :            :          */
<span class="lineNum">     355 </span>                :<span class="lineCov">          1 :         function isPriorityDone() {</span>
<span class="lineNum">     356 </span>                :<span class="lineNoCov">          0 :             var priorityDone = true,</span>
<span class="lineNum">     357 </span>                :            :                 priorityWait = config.priorityWait,
<span class="lineNum">     358 </span>                :            :                 priorityName, i;
<span class="lineNum">     359 </span>                :<span class="lineNoCov">          0 :             if (priorityWait) {</span>
<span class="lineNum">     360 </span>                :<span class="lineNoCov">          0 :                 for (i = 0; (priorityName = priorityWait[i]); i++) {</span>
<span class="lineNum">     361 </span>                :<span class="lineNoCov">          0 :                     if (!loaded[priorityName]) {</span>
<span class="lineNum">     362 </span>                :<span class="lineNoCov">          0 :                         priorityDone = false;</span>
<span class="lineNum">     363 </span>                :<span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     364 </span>                :            :                     }
<span class="lineNum">     365 </span>                :            :                 }
<span class="lineNum">     366 </span>                :<span class="lineNoCov">          0 :                 if (priorityDone) {</span>
<span class="lineNum">     367 </span>                :<span class="lineNoCov">          0 :                     delete config.priorityWait;</span>
<span class="lineNum">     368 </span>                :            :                 }
<span class="lineNum">     369 </span>                :            :             }
<span class="lineNum">     370 </span>                :<span class="lineNoCov">          0 :             return priorityDone;</span>
<span class="lineNum">     371 </span>                :            :         }
<span class="lineNum">     372 </span>                :            : 
<span class="lineNum">     373 </span>                :<span class="lineCov">          1 :         function makeContextModuleFunc(func, relModuleMap, enableBuildCallback) {</span>
<span class="lineNum">     374 </span>                :<span class="lineNoCov">          0 :             return function () {</span>
<span class="lineNum">     375 </span>                :            :                 //A version of a require function that passes a moduleName
<span class="lineNum">     376 </span>                :            :                 //value for items that may need to
<span class="lineNum">     377 </span>                :            :                 //look up paths relative to the moduleName
<span class="lineNum">     378 </span>                :<span class="lineNoCov">          0 :                 var args = aps.call(arguments, 0), lastArg;</span>
<span class="lineNum">     379 </span>                :<span class="lineNoCov">          0 :                 if (enableBuildCallback &amp;&amp;</span>
<span class="lineNum">     380 </span>                :            :                     isFunction((lastArg = args[args.length - 1]))) {
<span class="lineNum">     381 </span>                :<span class="lineNoCov">          0 :                     lastArg.__requireJsBuild = true;</span>
<span class="lineNum">     382 </span>                :            :                 }
<span class="lineNum">     383 </span>                :<span class="lineNoCov">          0 :                 args.push(relModuleMap);</span>
<span class="lineNum">     384 </span>                :<span class="lineNoCov">          0 :                 return func.apply(null, args);</span>
<span class="lineNum">     385 </span>                :            :             };
<span class="lineNum">     386 </span>                :            :         }
<span class="lineNum">     387 </span>                :            : 
<span class="lineNum">     388 </span>                :            :         /**
<span class="lineNum">     389 </span>                :            :          * Helper function that creates a require function object to give to
<span class="lineNum">     390 </span>                :            :          * modules that ask for it as a dependency. It needs to be specific
<span class="lineNum">     391 </span>                :            :          * per module because of the implication of path mappings that may
<span class="lineNum">     392 </span>                :            :          * need to be relative to the module name.
<span class="lineNum">     393 </span>                :            :          */
<span class="lineNum">     394 </span>                :<span class="lineCov">          1 :         function makeRequire(relModuleMap, enableBuildCallback) {</span>
<span class="lineNum">     395 </span>                :<span class="lineNoCov">          0 :             var modRequire = makeContextModuleFunc(context.require, relModuleMap, enableBuildCallback);</span>
<span class="lineNum">     396 </span>                :            : 
<span class="lineNum">     397 </span>                :<span class="lineNoCov">          0 :             mixin(modRequire, {</span>
<span class="lineNum">     398 </span>                :            :                 nameToUrl: makeContextModuleFunc(context.nameToUrl, relModuleMap),
<span class="lineNum">     399 </span>                :            :                 toUrl: makeContextModuleFunc(context.toUrl, relModuleMap),
<span class="lineNum">     400 </span>                :            :                 defined: makeContextModuleFunc(context.requireDefined, relModuleMap),
<span class="lineNum">     401 </span>                :            :                 specified: makeContextModuleFunc(context.requireSpecified, relModuleMap),
<span class="lineNum">     402 </span>                :            :                 isBrowser: req.isBrowser
<span class="lineNum">     403 </span>                :            :             });
<span class="lineNum">     404 </span>                :<span class="lineNoCov">          0 :             return modRequire;</span>
<span class="lineNum">     405 </span>                :            :         }
<span class="lineNum">     406 </span>                :            : 
<span class="lineNum">     407 </span>                :            :         /*
<span class="lineNum">     408 </span>                :            :          * Queues a dependency for checking after the loader is out of a
<span class="lineNum">     409 </span>                :            :          * &quot;paused&quot; state, for example while a script file is being loaded
<span class="lineNum">     410 </span>                :            :          * in the browser, where it may have many modules defined in it.
<span class="lineNum">     411 </span>                :            :          */
<span class="lineNum">     412 </span>                :<span class="lineCov">          1 :         function queueDependency(manager) {</span>
<span class="lineNum">     413 </span>                :<span class="lineCov">          2 :             context.paused.push(manager);</span>
<span class="lineNum">     414 </span>                :            :         }
<span class="lineNum">     415 </span>                :            : 
<span class="lineNum">     416 </span>                :<span class="lineCov">          1 :         function execManager(manager) {</span>
<span class="lineNum">     417 </span>                :<span class="lineCov">          2 :             var i, ret, err, errFile, errModuleTree,</span>
<span class="lineNum">     418 </span>                :            :                 cb = manager.callback,
<span class="lineNum">     419 </span>                :            :                 map = manager.map,
<span class="lineNum">     420 </span>                :            :                 fullName = map.fullName,
<span class="lineNum">     421 </span>                :            :                 args = manager.deps,
<span class="lineNum">     422 </span>                :            :                 listeners = manager.listeners,
<span class="lineNum">     423 </span>                :            :                 cjsModule;
<span class="lineNum">     424 </span>                :            : 
<span class="lineNum">     425 </span>                :            :             //Call the callback to define the module, if necessary.
<span class="lineNum">     426 </span>                :<span class="lineCov">          2 :             if (cb &amp;&amp; isFunction(cb)) {</span>
<span class="lineNum">     427 </span>                :<span class="lineCov">          2 :                 if (config.catchError.define) {</span>
<span class="lineNum">     428 </span>                :<span class="lineNoCov">          0 :                     try {</span>
<span class="lineNum">     429 </span>                :<span class="lineNoCov">          0 :                         ret = req.execCb(fullName, manager.callback, args, defined[fullName]);</span>
<span class="lineNum">     430 </span>                :            :                     } catch (e) {
<span class="lineNum">     431 </span>                :<span class="lineNoCov">          0 :                         err = e;</span>
<span class="lineNum">     432 </span>                :            :                     }
<span class="lineNum">     433 </span>                :            :                 } else {
<span class="lineNum">     434 </span>                :<span class="lineCov">          2 :                     ret = req.execCb(fullName, manager.callback, args, defined[fullName]);</span>
<span class="lineNum">     435 </span>                :            :                 }
<span class="lineNum">     436 </span>                :            : 
<span class="lineNum">     437 </span>                :<span class="lineCov">          2 :                 if (fullName) {</span>
<span class="lineNum">     438 </span>                :            :                     //If setting exports via &quot;module&quot; is in play,
<span class="lineNum">     439 </span>                :            :                     //favor that over return value and exports. After that,
<span class="lineNum">     440 </span>                :            :                     //favor a non-undefined return value over exports use.
<span class="lineNum">     441 </span>                :<span class="lineCov">          1 :                     cjsModule = manager.cjsModule;</span>
<span class="lineNum">     442 </span>                :<span class="lineCov">          1 :                     if (cjsModule &amp;&amp;</span>
<span class="lineNum">     443 </span>                :            :                         cjsModule.exports !== undefined &amp;&amp;
<span class="lineNum">     444 </span>                :            :                         //Make sure it is not already the exports value
<span class="lineNum">     445 </span>                :            :                         cjsModule.exports !== defined[fullName]) {
<span class="lineNum">     446 </span>                :<span class="lineNoCov">          0 :                         ret = defined[fullName] = manager.cjsModule.exports;</span>
<span class="lineNum">     447 </span>                :<span class="lineCov">          1 :                     } else if (ret === undefined &amp;&amp; manager.usingExports) {</span>
<span class="lineNum">     448 </span>                :            :                         //exports already set the defined value.
<span class="lineNum">     449 </span>                :<span class="lineNoCov">          0 :                         ret = defined[fullName];</span>
<span class="lineNum">     450 </span>                :            :                     } else {
<span class="lineNum">     451 </span>                :            :                         //Use the return value from the function.
<span class="lineNum">     452 </span>                :<span class="lineCov">          1 :                         defined[fullName] = ret;</span>
<span class="lineNum">     453 </span>                :            :                         //If this module needed full execution in a build
<span class="lineNum">     454 </span>                :            :                         //environment, mark that now.
<span class="lineNum">     455 </span>                :<span class="lineCov">          1 :                         if (needFullExec[fullName]) {</span>
<span class="lineNum">     456 </span>                :<span class="lineNoCov">          0 :                             fullExec[fullName] = true;</span>
<span class="lineNum">     457 </span>                :            :                         }
<span class="lineNum">     458 </span>                :            :                     }
<span class="lineNum">     459 </span>                :            :                 }
<span class="lineNum">     460 </span>                :<span class="lineNoCov">          0 :             } else if (fullName) {</span>
<span class="lineNum">     461 </span>                :            :                 //May just be an object definition for the module. Only
<span class="lineNum">     462 </span>                :            :                 //worry about defining if have a module name.
<span class="lineNum">     463 </span>                :<span class="lineNoCov">          0 :                 ret = defined[fullName] = cb;</span>
<span class="lineNum">     464 </span>                :            : 
<span class="lineNum">     465 </span>                :            :                 //If this module needed full execution in a build
<span class="lineNum">     466 </span>                :            :                 //environment, mark that now.
<span class="lineNum">     467 </span>                :<span class="lineNoCov">          0 :                 if (needFullExec[fullName]) {</span>
<span class="lineNum">     468 </span>                :<span class="lineNoCov">          0 :                     fullExec[fullName] = true;</span>
<span class="lineNum">     469 </span>                :            :                 }
<span class="lineNum">     470 </span>                :            :             }
<span class="lineNum">     471 </span>                :            : 
<span class="lineNum">     472 </span>                :            :             //Clean up waiting. Do this before error calls, and before
<span class="lineNum">     473 </span>                :            :             //calling back listeners, so that bookkeeping is correct
<span class="lineNum">     474 </span>                :            :             //in the event of an error and error is reported in correct order,
<span class="lineNum">     475 </span>                :            :             //since the listeners will likely have errors if the
<span class="lineNum">     476 </span>                :            :             //onError function does not throw.
<span class="lineNum">     477 </span>                :<span class="lineCov">          2 :             if (waiting[manager.id]) {</span>
<span class="lineNum">     478 </span>                :<span class="lineCov">          2 :                 delete waiting[manager.id];</span>
<span class="lineNum">     479 </span>                :<span class="lineCov">          2 :                 manager.isDone = true;</span>
<span class="lineNum">     480 </span>                :<span class="lineCov">          2 :                 context.waitCount -= 1;</span>
<span class="lineNum">     481 </span>                :<span class="lineCov">          2 :                 if (context.waitCount === 0) {</span>
<span class="lineNum">     482 </span>                :            :                     //Clear the wait array used for cycles.
<span class="lineNum">     483 </span>                :<span class="lineCov">          1 :                     waitAry = [];</span>
<span class="lineNum">     484 </span>                :            :                 }
<span class="lineNum">     485 </span>                :            :             }
<span class="lineNum">     486 </span>                :            : 
<span class="lineNum">     487 </span>                :            :             //Do not need to track manager callback now that it is defined.
<span class="lineNum">     488 </span>                :<span class="lineCov">          2 :             delete managerCallbacks[fullName];</span>
<span class="lineNum">     489 </span>                :            : 
<span class="lineNum">     490 </span>                :            :             //Allow instrumentation like the optimizer to know the order
<span class="lineNum">     491 </span>                :            :             //of modules executed and their dependencies.
<span class="lineNum">     492 </span>                :<span class="lineCov">          2 :             if (req.onResourceLoad &amp;&amp; !manager.placeholder) {</span>
<span class="lineNum">     493 </span>                :<span class="lineNoCov">          0 :                 req.onResourceLoad(context, map, manager.depArray);</span>
<span class="lineNum">     494 </span>                :            :             }
<span class="lineNum">     495 </span>                :            : 
<span class="lineNum">     496 </span>                :<span class="lineCov">          2 :             if (err) {</span>
<span class="lineNum">     497 </span>                :<span class="lineNoCov">          0 :                 errFile = (fullName ? makeModuleMap(fullName).url : '') ||</span>
<span class="lineNum">     498 </span>                :            :                            err.fileName || err.sourceURL;
<span class="lineNum">     499 </span>                :<span class="lineNoCov">          0 :                 errModuleTree = err.moduleTree;</span>
<span class="lineNum">     500 </span>                :<span class="lineNoCov">          0 :                 err = makeError('defineerror', 'Error evaluating ' +</span>
<span class="lineNum">     501 </span>                :            :                                 'module &quot;' + fullName + '&quot; at location &quot;' +
<span class="lineNum">     502 </span>                :            :                                 errFile + '&quot;:\n' +
<span class="lineNum">     503 </span>                :            :                                 err + '\nfileName:' + errFile +
<span class="lineNum">     504 </span>                :            :                                 '\nlineNumber: ' + (err.lineNumber || err.line), err);
<span class="lineNum">     505 </span>                :<span class="lineNoCov">          0 :                 err.moduleName = fullName;</span>
<span class="lineNum">     506 </span>                :<span class="lineNoCov">          0 :                 err.moduleTree = errModuleTree;</span>
<span class="lineNum">     507 </span>                :<span class="lineNoCov">          0 :                 return req.onError(err);</span>
<span class="lineNum">     508 </span>                :            :             }
<span class="lineNum">     509 </span>                :            : 
<span class="lineNum">     510 </span>                :            :             //Let listeners know of this manager's value.
<span class="lineNum">     511 </span>                :<span class="lineCov">          2 :             for (i = 0; (cb = listeners[i]); i++) {</span>
<span class="lineNum">     512 </span>                :<span class="lineCov">          1 :                 cb(ret);</span>
<span class="lineNum">     513 </span>                :            :             }
<span class="lineNum">     514 </span>                :            : 
<span class="lineNum">     515 </span>                :<span class="lineCov">          2 :             return undefined;</span>
<span class="lineNum">     516 </span>                :            :         }
<span class="lineNum">     517 </span>                :            : 
<span class="lineNum">     518 </span>                :            :         /**
<span class="lineNum">     519 </span>                :            :          * Helper that creates a callack function that is called when a dependency
<span class="lineNum">     520 </span>                :            :          * is ready, and sets the i-th dependency for the manager as the
<span class="lineNum">     521 </span>                :            :          * value passed to the callback generated by this function.
<span class="lineNum">     522 </span>                :            :          */
<span class="lineNum">     523 </span>                :<span class="lineCov">          1 :         function makeArgCallback(manager, i) {</span>
<span class="lineNum">     524 </span>                :<span class="lineCov">          2 :             return function (value) {</span>
<span class="lineNum">     525 </span>                :            :                 //Only do the work if it has not been done
<span class="lineNum">     526 </span>                :            :                 //already for a dependency. Cycle breaking
<span class="lineNum">     527 </span>                :            :                 //logic in forceExec could mean this function
<span class="lineNum">     528 </span>                :            :                 //is called more than once for a given dependency.
<span class="lineNum">     529 </span>                :<span class="lineCov">          1 :                 if (!manager.depDone[i]) {</span>
<span class="lineNum">     530 </span>                :<span class="lineCov">          1 :                     manager.depDone[i] = true;</span>
<span class="lineNum">     531 </span>                :<span class="lineCov">          1 :                     manager.deps[i] = value;</span>
<span class="lineNum">     532 </span>                :<span class="lineCov">          1 :                     manager.depCount -= 1;</span>
<span class="lineNum">     533 </span>                :<span class="lineCov">          1 :                     if (!manager.depCount) {</span>
<span class="lineNum">     534 </span>                :            :                         //All done, execute!
<span class="lineNum">     535 </span>                :<span class="lineCov">          1 :                         execManager(manager);</span>
<span class="lineNum">     536 </span>                :            :                     }
<span class="lineNum">     537 </span>                :            :                 }
<span class="lineNum">     538 </span>                :            :             };
<span class="lineNum">     539 </span>                :            :         }
<span class="lineNum">     540 </span>                :            : 
<span class="lineNum">     541 </span>                :<span class="lineCov">          1 :         function callPlugin(pluginName, depManager) {</span>
<span class="lineNum">     542 </span>                :<span class="lineNoCov">          0 :             var map = depManager.map,</span>
<span class="lineNum">     543 </span>                :            :                 fullName = map.fullName,
<span class="lineNum">     544 </span>                :            :                 name = map.name,
<span class="lineNum">     545 </span>                :            :                 plugin = plugins[pluginName] ||
<span class="lineNum">     546 </span>                :            :                         (plugins[pluginName] = defined[pluginName]),
<span class="lineNum">     547 </span>                :            :                 load;
<span class="lineNum">     548 </span>                :            : 
<span class="lineNum">     549 </span>                :            :             //No need to continue if the manager is already
<span class="lineNum">     550 </span>                :            :             //in the process of loading.
<span class="lineNum">     551 </span>                :<span class="lineNoCov">          0 :             if (depManager.loading) {</span>
<span class="lineNum">     552 </span>                :<span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">     553 </span>                :            :             }
<span class="lineNum">     554 </span>                :<span class="lineNoCov">          0 :             depManager.loading = true;</span>
<span class="lineNum">     555 </span>                :            : 
<span class="lineNum">     556 </span>                :<span class="lineNoCov">          0 :             load = function (ret) {</span>
<span class="lineNum">     557 </span>                :<span class="lineNoCov">          0 :                 depManager.callback = function () {</span>
<span class="lineNum">     558 </span>                :<span class="lineNoCov">          0 :                     return ret;</span>
<span class="lineNum">     559 </span>                :            :                 };
<span class="lineNum">     560 </span>                :<span class="lineNoCov">          0 :                 execManager(depManager);</span>
<span class="lineNum">     561 </span>                :            : 
<span class="lineNum">     562 </span>                :<span class="lineNoCov">          0 :                 loaded[depManager.id] = true;</span>
<span class="lineNum">     563 </span>                :            : 
<span class="lineNum">     564 </span>                :            :                 //The loading of this plugin
<span class="lineNum">     565 </span>                :            :                 //might have placed other things
<span class="lineNum">     566 </span>                :            :                 //in the paused queue. In particular,
<span class="lineNum">     567 </span>                :            :                 //a loader plugin that depends on
<span class="lineNum">     568 </span>                :            :                 //a different plugin loaded resource.
<span class="lineNum">     569 </span>                :<span class="lineNoCov">          0 :                 resume();</span>
<span class="lineNum">     570 </span>                :            :             };
<span class="lineNum">     571 </span>                :            : 
<span class="lineNum">     572 </span>                :            :             //Allow plugins to load other code without having to know the
<span class="lineNum">     573 </span>                :            :             //context or how to &quot;complete&quot; the load.
<span class="lineNum">     574 </span>                :<span class="lineNoCov">          0 :             load.fromText = function (moduleName, text) {</span>
<span class="lineNum">     575 </span>                :            :                 /*jslint evil: true */
<span class="lineNum">     576 </span>                :<span class="lineNoCov">          0 :                 var hasInteractive = useInteractive;</span>
<span class="lineNum">     577 </span>                :            : 
<span class="lineNum">     578 </span>                :            :                 //Indicate a the module is in process of loading.
<span class="lineNum">     579 </span>                :<span class="lineNoCov">          0 :                 loaded[moduleName] = false;</span>
<span class="lineNum">     580 </span>                :<span class="lineNoCov">          0 :                 context.scriptCount += 1;</span>
<span class="lineNum">     581 </span>                :            : 
<span class="lineNum">     582 </span>                :            :                 //Indicate this is not a &quot;real&quot; module, so do not track it
<span class="lineNum">     583 </span>                :            :                 //for builds, it does not map to a real file.
<span class="lineNum">     584 </span>                :<span class="lineNoCov">          0 :                 context.fake[moduleName] = true;</span>
<span class="lineNum">     585 </span>                :            : 
<span class="lineNum">     586 </span>                :            :                 //Turn off interactive script matching for IE for any define
<span class="lineNum">     587 </span>                :            :                 //calls in the text, then turn it back on at the end.
<span class="lineNum">     588 </span>                :<span class="lineNoCov">          0 :                 if (hasInteractive) {</span>
<span class="lineNum">     589 </span>                :<span class="lineNoCov">          0 :                     useInteractive = false;</span>
<span class="lineNum">     590 </span>                :            :                 }
<span class="lineNum">     591 </span>                :            : 
<span class="lineNum">     592 </span>                :<span class="lineNoCov">          0 :                 req.exec(text);</span>
<span class="lineNum">     593 </span>                :            : 
<span class="lineNum">     594 </span>                :<span class="lineNoCov">          0 :                 if (hasInteractive) {</span>
<span class="lineNum">     595 </span>                :<span class="lineNoCov">          0 :                     useInteractive = true;</span>
<span class="lineNum">     596 </span>                :            :                 }
<span class="lineNum">     597 </span>                :            : 
<span class="lineNum">     598 </span>                :            :                 //Support anonymous modules.
<span class="lineNum">     599 </span>                :<span class="lineNoCov">          0 :                 context.completeLoad(moduleName);</span>
<span class="lineNum">     600 </span>                :            :             };
<span class="lineNum">     601 </span>                :            : 
<span class="lineNum">     602 </span>                :            :             //No need to continue if the plugin value has already been
<span class="lineNum">     603 </span>                :            :             //defined by a build.
<span class="lineNum">     604 </span>                :<span class="lineNoCov">          0 :             if (fullName in defined) {</span>
<span class="lineNum">     605 </span>                :<span class="lineNoCov">          0 :                 load(defined[fullName]);</span>
<span class="lineNum">     606 </span>                :            :             } else {
<span class="lineNum">     607 </span>                :            :                 //Use parentName here since the plugin's name is not reliable,
<span class="lineNum">     608 </span>                :            :                 //could be some weird string with no path that actually wants to
<span class="lineNum">     609 </span>                :            :                 //reference the parentName's path.
<span class="lineNum">     610 </span>                :<span class="lineNoCov">          0 :                 plugin.load(name, makeRequire(map.parentMap, true), load, config);</span>
<span class="lineNum">     611 </span>                :            :             }
<span class="lineNum">     612 </span>                :            :         }
<span class="lineNum">     613 </span>                :            : 
<span class="lineNum">     614 </span>                :            :         /**
<span class="lineNum">     615 </span>                :            :          * Adds the manager to the waiting queue. Only fully
<span class="lineNum">     616 </span>                :            :          * resolved items should be in the waiting queue.
<span class="lineNum">     617 </span>                :            :          */
<span class="lineNum">     618 </span>                :<span class="lineCov">          1 :         function addWait(manager) {</span>
<span class="lineNum">     619 </span>                :<span class="lineCov">          4 :             if (!waiting[manager.id]) {</span>
<span class="lineNum">     620 </span>                :<span class="lineCov">          4 :                 waiting[manager.id] = manager;</span>
<span class="lineNum">     621 </span>                :<span class="lineCov">          4 :                 waitAry.push(manager);</span>
<span class="lineNum">     622 </span>                :<span class="lineCov">          4 :                 context.waitCount += 1;</span>
<span class="lineNum">     623 </span>                :            :             }
<span class="lineNum">     624 </span>                :            :         }
<span class="lineNum">     625 </span>                :            : 
<span class="lineNum">     626 </span>                :            :         /**
<span class="lineNum">     627 </span>                :            :          * Function added to every manager object. Created out here
<span class="lineNum">     628 </span>                :            :          * to avoid new function creation for each manager instance.
<span class="lineNum">     629 </span>                :            :          */
<span class="lineNum">     630 </span>                :<span class="lineCov">          1 :         function managerAdd(cb) {</span>
<span class="lineNum">     631 </span>                :<span class="lineCov">          2 :             this.listeners.push(cb);</span>
<span class="lineNum">     632 </span>                :            :         }
<span class="lineNum">     633 </span>                :            : 
<span class="lineNum">     634 </span>                :<span class="lineCov">          1 :         function getManager(map, shouldQueue) {</span>
<span class="lineNum">     635 </span>                :<span class="lineCov">          5 :             var fullName = map.fullName,</span>
<span class="lineNum">     636 </span>                :            :                 prefix = map.prefix,
<span class="lineNum">     637 </span>                :            :                 plugin = prefix ? plugins[prefix] ||
<span class="lineNum">     638 </span>                :            :                                 (plugins[prefix] = defined[prefix]) : null,
<span class="lineNum">     639 </span>                :            :                 manager, created, pluginManager, prefixMap;
<span class="lineNum">     640 </span>                :            : 
<span class="lineNum">     641 </span>                :<span class="lineCov">          5 :             if (fullName) {</span>
<span class="lineNum">     642 </span>                :<span class="lineCov">          3 :                 manager = managerCallbacks[fullName];</span>
<span class="lineNum">     643 </span>                :            :             }
<span class="lineNum">     644 </span>                :            : 
<span class="lineNum">     645 </span>                :<span class="lineCov">          5 :             if (!manager) {</span>
<span class="lineNum">     646 </span>                :<span class="lineCov">          4 :                 created = true;</span>
<span class="lineNum">     647 </span>                :<span class="lineCov">          4 :                 manager = {</span>
<span class="lineNum">     648 </span>                :            :                     //ID is just the full name, but if it is a plugin resource
<span class="lineNum">     649 </span>                :            :                     //for a plugin that has not been loaded,
<span class="lineNum">     650 </span>                :            :                     //then add an ID counter to it.
<span class="lineNum">     651 </span>                :            :                     id: (prefix &amp;&amp; !plugin ?
<span class="lineNum">     652 </span>                :            :                         (managerCounter++) + '__p@:' : '') +
<span class="lineNum">     653 </span>                :            :                         (fullName || '__r@' + (managerCounter++)),
<span class="lineNum">     654 </span>                :            :                     map: map,
<span class="lineNum">     655 </span>                :            :                     depCount: 0,
<span class="lineNum">     656 </span>                :            :                     depDone: [],
<span class="lineNum">     657 </span>                :            :                     depCallbacks: [],
<span class="lineNum">     658 </span>                :            :                     deps: [],
<span class="lineNum">     659 </span>                :            :                     listeners: [],
<span class="lineNum">     660 </span>                :            :                     add: managerAdd
<span class="lineNum">     661 </span>                :            :                 };
<span class="lineNum">     662 </span>                :            : 
<span class="lineNum">     663 </span>                :<span class="lineCov">          4 :                 specified[manager.id] = true;</span>
<span class="lineNum">     664 </span>                :            : 
<span class="lineNum">     665 </span>                :            :                 //Only track the manager/reuse it if this is a non-plugin
<span class="lineNum">     666 </span>                :            :                 //resource. Also only track plugin resources once
<span class="lineNum">     667 </span>                :            :                 //the plugin has been loaded, and so the fullName is the
<span class="lineNum">     668 </span>                :            :                 //true normalized value.
<span class="lineNum">     669 </span>                :<span class="lineCov">          4 :                 if (fullName &amp;&amp; (!prefix || plugins[prefix])) {</span>
<span class="lineNum">     670 </span>                :<span class="lineCov">          2 :                     managerCallbacks[fullName] = manager;</span>
<span class="lineNum">     671 </span>                :            :                 }
<span class="lineNum">     672 </span>                :            :             }
<span class="lineNum">     673 </span>                :            : 
<span class="lineNum">     674 </span>                :            :             //If there is a plugin needed, but it is not loaded,
<span class="lineNum">     675 </span>                :            :             //first load the plugin, then continue on.
<span class="lineNum">     676 </span>                :<span class="lineCov">          5 :             if (prefix &amp;&amp; !plugin) {</span>
<span class="lineNum">     677 </span>                :<span class="lineNoCov">          0 :                 prefixMap = makeModuleMap(prefix);</span>
<span class="lineNum">     678 </span>                :            : 
<span class="lineNum">     679 </span>                :            :                 //Clear out defined and urlFetched if the plugin was previously
<span class="lineNum">     680 </span>                :            :                 //loaded/defined, but not as full module (as in a build
<span class="lineNum">     681 </span>                :            :                 //situation). However, only do this work if the plugin is in
<span class="lineNum">     682 </span>                :            :                 //defined but does not have a module export value.
<span class="lineNum">     683 </span>                :<span class="lineNoCov">          0 :                 if (prefix in defined &amp;&amp; !defined[prefix]) {</span>
<span class="lineNum">     684 </span>                :<span class="lineNoCov">          0 :                     delete defined[prefix];</span>
<span class="lineNum">     685 </span>                :<span class="lineNoCov">          0 :                     delete urlFetched[prefixMap.url];</span>
<span class="lineNum">     686 </span>                :            :                 }
<span class="lineNum">     687 </span>                :            : 
<span class="lineNum">     688 </span>                :<span class="lineNoCov">          0 :                 pluginManager = getManager(prefixMap, true);</span>
<span class="lineNum">     689 </span>                :<span class="lineNoCov">          0 :                 pluginManager.add(function (plugin) {</span>
<span class="lineNum">     690 </span>                :            :                     //Create a new manager for the normalized
<span class="lineNum">     691 </span>                :            :                     //resource ID and have it call this manager when
<span class="lineNum">     692 </span>                :            :                     //done.
<span class="lineNum">     693 </span>                :<span class="lineNoCov">          0 :                     var newMap = makeModuleMap(map.originalName, map.parentMap),</span>
<span class="lineNum">     694 </span>                :            :                         normalizedManager = getManager(newMap, true);
<span class="lineNum">     695 </span>                :            : 
<span class="lineNum">     696 </span>                :            :                     //Indicate this manager is a placeholder for the real,
<span class="lineNum">     697 </span>                :            :                     //normalized thing. Important for when trying to map
<span class="lineNum">     698 </span>                :            :                     //modules and dependencies, for instance, in a build.
<span class="lineNum">     699 </span>                :<span class="lineNoCov">          0 :                     manager.placeholder = true;</span>
<span class="lineNum">     700 </span>                :            : 
<span class="lineNum">     701 </span>                :<span class="lineNoCov">          0 :                     normalizedManager.add(function (resource) {</span>
<span class="lineNum">     702 </span>                :<span class="lineNoCov">          0 :                         manager.callback = function () {</span>
<span class="lineNum">     703 </span>                :<span class="lineNoCov">          0 :                             return resource;</span>
<span class="lineNum">     704 </span>                :            :                         };
<span class="lineNum">     705 </span>                :<span class="lineNoCov">          0 :                         execManager(manager);</span>
<span class="lineNum">     706 </span>                :            :                     });
<span class="lineNum">     707 </span>                :            :                 });
<span class="lineNum">     708 </span>                :<span class="lineCov">          5 :             } else if (created &amp;&amp; shouldQueue) {</span>
<span class="lineNum">     709 </span>                :            :                 //Indicate the resource is not loaded yet if it is to be
<span class="lineNum">     710 </span>                :            :                 //queued.
<span class="lineNum">     711 </span>                :<span class="lineCov">          2 :                 loaded[manager.id] = false;</span>
<span class="lineNum">     712 </span>                :<span class="lineCov">          2 :                 queueDependency(manager);</span>
<span class="lineNum">     713 </span>                :<span class="lineCov">          2 :                 addWait(manager);</span>
<span class="lineNum">     714 </span>                :            :             }
<span class="lineNum">     715 </span>                :            : 
<span class="lineNum">     716 </span>                :<span class="lineCov">          5 :             return manager;</span>
<span class="lineNum">     717 </span>                :            :         }
<span class="lineNum">     718 </span>                :            : 
<span class="lineNum">     719 </span>                :<span class="lineCov">          1 :         function main(inName, depArray, callback, relModuleMap) {</span>
<span class="lineNum">     720 </span>                :<span class="lineCov">          3 :             var moduleMap = makeModuleMap(inName, relModuleMap),</span>
<span class="lineNum">     721 </span>                :            :                 name = moduleMap.name,
<span class="lineNum">     722 </span>                :            :                 fullName = moduleMap.fullName,
<span class="lineNum">     723 </span>                :            :                 manager = getManager(moduleMap),
<span class="lineNum">     724 </span>                :            :                 id = manager.id,
<span class="lineNum">     725 </span>                :            :                 deps = manager.deps,
<span class="lineNum">     726 </span>                :            :                 i, depArg, depName, depPrefix, cjsMod;
<span class="lineNum">     727 </span>                :            : 
<span class="lineNum">     728 </span>                :<span class="lineCov">          3 :             if (fullName) {</span>
<span class="lineNum">     729 </span>                :            :                 //If module already defined for context, or already loaded,
<span class="lineNum">     730 </span>                :            :                 //then leave. Also leave if jQuery is registering but it does
<span class="lineNum">     731 </span>                :            :                 //not match the desired version number in the config.
<span class="lineNum">     732 </span>                :<span class="lineCov">          1 :                 if (fullName in defined || loaded[id] === true ||</span>
<span class="lineNum">     733 </span>                :            :                     (fullName === &quot;jquery&quot; &amp;&amp; config.jQuery &amp;&amp;
<span class="lineNum">     734 </span>                :            :                      config.jQuery !== callback().fn.jquery)) {
<span class="lineNum">     735 </span>                :<span class="lineNoCov">          0 :                     return;</span>
<span class="lineNum">     736 </span>                :            :                 }
<span class="lineNum">     737 </span>                :            : 
<span class="lineNum">     738 </span>                :            :                 //Set specified/loaded here for modules that are also loaded
<span class="lineNum">     739 </span>                :            :                 //as part of a layer, where onScriptLoad is not fired
<span class="lineNum">     740 </span>                :            :                 //for those cases. Do this after the inline define and
<span class="lineNum">     741 </span>                :            :                 //dependency tracing is done.
<span class="lineNum">     742 </span>                :<span class="lineCov">          1 :                 specified[id] = true;</span>
<span class="lineNum">     743 </span>                :<span class="lineCov">          1 :                 loaded[id] = true;</span>
<span class="lineNum">     744 </span>                :            : 
<span class="lineNum">     745 </span>                :            :                 //If module is jQuery set up delaying its dom ready listeners.
<span class="lineNum">     746 </span>                :<span class="lineCov">          1 :                 if (fullName === &quot;jquery&quot; &amp;&amp; callback) {</span>
<span class="lineNum">     747 </span>                :<span class="lineNoCov">          0 :                     jQueryCheck(callback());</span>
<span class="lineNum">     748 </span>                :            :                 }
<span class="lineNum">     749 </span>                :            :             }
<span class="lineNum">     750 </span>                :            : 
<span class="lineNum">     751 </span>                :            :             //Attach real depArray and callback to the manager. Do this
<span class="lineNum">     752 </span>                :            :             //only if the module has not been defined already, so do this after
<span class="lineNum">     753 </span>                :            :             //the fullName checks above. IE can call main() more than once
<span class="lineNum">     754 </span>                :            :             //for a module.
<span class="lineNum">     755 </span>                :<span class="lineCov">          3 :             manager.depArray = depArray;</span>
<span class="lineNum">     756 </span>                :<span class="lineCov">          3 :             manager.callback = callback;</span>
<span class="lineNum">     757 </span>                :            : 
<span class="lineNum">     758 </span>                :            :             //Add the dependencies to the deps field, and register for callbacks
<span class="lineNum">     759 </span>                :            :             //on the dependencies.
<span class="lineNum">     760 </span>                :<span class="lineCov">          3 :             for (i = 0; i &lt; depArray.length; i++) {</span>
<span class="lineNum">     761 </span>                :<span class="lineCov">          2 :                 depArg = depArray[i];</span>
<span class="lineNum">     762 </span>                :            :                 //There could be cases like in IE, where a trailing comma will
<span class="lineNum">     763 </span>                :            :                 //introduce a null dependency, so only treat a real dependency
<span class="lineNum">     764 </span>                :            :                 //value as a dependency.
<span class="lineNum">     765 </span>                :<span class="lineCov">          2 :                 if (depArg) {</span>
<span class="lineNum">     766 </span>                :            :                     //Split the dependency name into plugin and name parts
<span class="lineNum">     767 </span>                :<span class="lineCov">          2 :                     depArg = makeModuleMap(depArg, (name ? moduleMap : relModuleMap));</span>
<span class="lineNum">     768 </span>                :<span class="lineCov">          2 :                     depName = depArg.fullName;</span>
<span class="lineNum">     769 </span>                :<span class="lineCov">          2 :                     depPrefix = depArg.prefix;</span>
<span class="lineNum">     770 </span>                :            : 
<span class="lineNum">     771 </span>                :            :                     //Fix the name in depArray to be just the name, since
<span class="lineNum">     772 </span>                :            :                     //that is how it will be called back later.
<span class="lineNum">     773 </span>                :<span class="lineCov">          2 :                     depArray[i] = depName;</span>
<span class="lineNum">     774 </span>                :            : 
<span class="lineNum">     775 </span>                :            :                     //Fast path CommonJS standard dependencies.
<span class="lineNum">     776 </span>                :<span class="lineCov">          2 :                     if (depName === &quot;require&quot;) {</span>
<span class="lineNum">     777 </span>                :<span class="lineNoCov">          0 :                         deps[i] = makeRequire(moduleMap);</span>
<span class="lineNum">     778 </span>                :<span class="lineCov">          2 :                     } else if (depName === &quot;exports&quot;) {</span>
<span class="lineNum">     779 </span>                :            :                         //CommonJS module spec 1.1
<span class="lineNum">     780 </span>                :<span class="lineNoCov">          0 :                         deps[i] = defined[fullName] = {};</span>
<span class="lineNum">     781 </span>                :<span class="lineNoCov">          0 :                         manager.usingExports = true;</span>
<span class="lineNum">     782 </span>                :<span class="lineCov">          2 :                     } else if (depName === &quot;module&quot;) {</span>
<span class="lineNum">     783 </span>                :            :                         //CommonJS module spec 1.1
<span class="lineNum">     784 </span>                :<span class="lineNoCov">          0 :                         manager.cjsModule = cjsMod = deps[i] = {</span>
<span class="lineNum">     785 </span>                :            :                             id: name,
<span class="lineNum">     786 </span>                :            :                             uri: name ? context.nameToUrl(name, null, relModuleMap) : undefined,
<span class="lineNum">     787 </span>                :            :                             exports: defined[fullName]
<span class="lineNum">     788 </span>                :            :                         };
<span class="lineNum">     789 </span>                :<span class="lineCov">          2 :                     } else if (depName in defined &amp;&amp; !(depName in waiting) &amp;&amp;</span>
<span class="lineNum">     790 </span>                :            :                                (!(fullName in needFullExec) ||
<span class="lineNum">     791 </span>                :            :                                 (fullName in needFullExec &amp;&amp; fullExec[depName]))) {
<span class="lineNum">     792 </span>                :            :                         //Module already defined, and not in a build situation
<span class="lineNum">     793 </span>                :            :                         //where the module is a something that needs full
<span class="lineNum">     794 </span>                :            :                         //execution and this dependency has not been fully
<span class="lineNum">     795 </span>                :            :                         //executed. See r.js's requirePatch.js for more info
<span class="lineNum">     796 </span>                :            :                         //on fullExec.
<span class="lineNum">     797 </span>                :<span class="lineNoCov">          0 :                         deps[i] = defined[depName];</span>
<span class="lineNum">     798 </span>                :            :                     } else {
<span class="lineNum">     799 </span>                :            :                         //Mark this dependency as needing full exec if
<span class="lineNum">     800 </span>                :            :                         //the current module needs full exec.
<span class="lineNum">     801 </span>                :<span class="lineCov">          2 :                         if (fullName in needFullExec) {</span>
<span class="lineNum">     802 </span>                :<span class="lineNoCov">          0 :                             needFullExec[depName] = true;</span>
<span class="lineNum">     803 </span>                :            :                             //Reset state so fully executed code will get
<span class="lineNum">     804 </span>                :            :                             //picked up correctly.
<span class="lineNum">     805 </span>                :<span class="lineNoCov">          0 :                             delete defined[depName];</span>
<span class="lineNum">     806 </span>                :<span class="lineNoCov">          0 :                             urlFetched[depArg.url] = false;</span>
<span class="lineNum">     807 </span>                :            :                         }
<span class="lineNum">     808 </span>                :            : 
<span class="lineNum">     809 </span>                :            :                         //Either a resource that is not loaded yet, or a plugin
<span class="lineNum">     810 </span>                :            :                         //resource for either a plugin that has not
<span class="lineNum">     811 </span>                :            :                         //loaded yet.
<span class="lineNum">     812 </span>                :<span class="lineCov">          2 :                         manager.depCount += 1;</span>
<span class="lineNum">     813 </span>                :<span class="lineCov">          2 :                         manager.depCallbacks[i] = makeArgCallback(manager, i);</span>
<span class="lineNum">     814 </span>                :<span class="lineCov">          2 :                         getManager(depArg, true).add(manager.depCallbacks[i]);</span>
<span class="lineNum">     815 </span>                :            :                     }
<span class="lineNum">     816 </span>                :            :                 }
<span class="lineNum">     817 </span>                :            :             }
<span class="lineNum">     818 </span>                :            : 
<span class="lineNum">     819 </span>                :            :             //Do not bother tracking the manager if it is all done.
<span class="lineNum">     820 </span>                :<span class="lineCov">          3 :             if (!manager.depCount) {</span>
<span class="lineNum">     821 </span>                :            :                 //All done, execute!
<span class="lineNum">     822 </span>                :<span class="lineCov">          1 :                 execManager(manager);</span>
<span class="lineNum">     823 </span>                :            :             } else {
<span class="lineNum">     824 </span>                :<span class="lineCov">          2 :                 addWait(manager);</span>
<span class="lineNum">     825 </span>                :            :             }
<span class="lineNum">     826 </span>                :            :         }
<span class="lineNum">     827 </span>                :            : 
<span class="lineNum">     828 </span>                :            :         /**
<span class="lineNum">     829 </span>                :            :          * Convenience method to call main for a define call that was put on
<span class="lineNum">     830 </span>                :            :          * hold in the defQueue.
<span class="lineNum">     831 </span>                :            :          */
<span class="lineNum">     832 </span>                :<span class="lineCov">          1 :         function callDefMain(args) {</span>
<span class="lineNum">     833 </span>                :<span class="lineCov">          1 :             main.apply(null, args);</span>
<span class="lineNum">     834 </span>                :            :         }
<span class="lineNum">     835 </span>                :            : 
<span class="lineNum">     836 </span>                :            :         /**
<span class="lineNum">     837 </span>                :            :          * jQuery 1.4.3+ supports ways to hold off calling
<span class="lineNum">     838 </span>                :            :          * calling jQuery ready callbacks until all scripts are loaded. Be sure
<span class="lineNum">     839 </span>                :            :          * to track it if the capability exists.. Also, since jQuery 1.4.3 does
<span class="lineNum">     840 </span>                :            :          * not register as a module, need to do some global inference checking.
<span class="lineNum">     841 </span>                :            :          * Even if it does register as a module, not guaranteed to be the precise
<span class="lineNum">     842 </span>                :            :          * name of the global. If a jQuery is tracked for this context, then go
<span class="lineNum">     843 </span>                :            :          * ahead and register it as a module too, if not already in process.
<span class="lineNum">     844 </span>                :            :          */
<span class="lineNum">     845 </span>                :<span class="lineCov">          1 :         jQueryCheck = function (jqCandidate) {</span>
<span class="lineNum">     846 </span>                :<span class="lineNoCov">          0 :             if (!context.jQuery) {</span>
<span class="lineNum">     847 </span>                :<span class="lineNoCov">          0 :                 var $ = jqCandidate || (typeof jQuery !== &quot;undefined&quot; ? jQuery : null);</span>
<span class="lineNum">     848 </span>                :            : 
<span class="lineNum">     849 </span>                :<span class="lineNoCov">          0 :                 if ($) {</span>
<span class="lineNum">     850 </span>                :            :                     //If a specific version of jQuery is wanted, make sure to only
<span class="lineNum">     851 </span>                :            :                     //use this jQuery if it matches.
<span class="lineNum">     852 </span>                :<span class="lineNoCov">          0 :                     if (config.jQuery &amp;&amp; $.fn.jquery !== config.jQuery) {</span>
<span class="lineNum">     853 </span>                :<span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">     854 </span>                :            :                     }
<span class="lineNum">     855 </span>                :            : 
<span class="lineNum">     856 </span>                :<span class="lineNoCov">          0 :                     if (&quot;holdReady&quot; in $ || &quot;readyWait&quot; in $) {</span>
<span class="lineNum">     857 </span>                :<span class="lineNoCov">          0 :                         context.jQuery = $;</span>
<span class="lineNum">     858 </span>                :            : 
<span class="lineNum">     859 </span>                :            :                         //Manually create a &quot;jquery&quot; module entry if not one already
<span class="lineNum">     860 </span>                :            :                         //or in process. Note this could trigger an attempt at
<span class="lineNum">     861 </span>                :            :                         //a second jQuery registration, but does no harm since
<span class="lineNum">     862 </span>                :            :                         //the first one wins, and it is the same value anyway.
<span class="lineNum">     863 </span>                :<span class="lineNoCov">          0 :                         callDefMain([&quot;jquery&quot;, [], function () {</span>
<span class="lineNum">     864 </span>                :<span class="lineNoCov">          0 :                             return jQuery;</span>
<span class="lineNum">     865 </span>                :            :                         }]);
<span class="lineNum">     866 </span>                :            : 
<span class="lineNum">     867 </span>                :            :                         //Ask jQuery to hold DOM ready callbacks.
<span class="lineNum">     868 </span>                :<span class="lineNoCov">          0 :                         if (context.scriptCount) {</span>
<span class="lineNum">     869 </span>                :<span class="lineNoCov">          0 :                             jQueryHoldReady($, true);</span>
<span class="lineNum">     870 </span>                :<span class="lineNoCov">          0 :                             context.jQueryIncremented = true;</span>
<span class="lineNum">     871 </span>                :            :                         }
<span class="lineNum">     872 </span>                :            :                     }
<span class="lineNum">     873 </span>                :            :                 }
<span class="lineNum">     874 </span>                :            :             }
<span class="lineNum">     875 </span>                :            :         };
<span class="lineNum">     876 </span>                :            : 
<span class="lineNum">     877 </span>                :<span class="lineCov">          1 :         function forceExec(manager, traced) {</span>
<span class="lineNum">     878 </span>                :<span class="lineNoCov">          0 :             if (manager.isDone) {</span>
<span class="lineNum">     879 </span>                :<span class="lineNoCov">          0 :                 return undefined;</span>
<span class="lineNum">     880 </span>                :            :             }
<span class="lineNum">     881 </span>                :            : 
<span class="lineNum">     882 </span>                :<span class="lineNoCov">          0 :             var fullName = manager.map.fullName,</span>
<span class="lineNum">     883 </span>                :            :                 depArray = manager.depArray,
<span class="lineNum">     884 </span>                :            :                 i, depName, depManager, prefix, prefixManager, value;
<span class="lineNum">     885 </span>                :            : 
<span class="lineNum">     886 </span>                :<span class="lineNoCov">          0 :             if (fullName) {</span>
<span class="lineNum">     887 </span>                :<span class="lineNoCov">          0 :                 if (traced[fullName]) {</span>
<span class="lineNum">     888 </span>                :<span class="lineNoCov">          0 :                     return defined[fullName];</span>
<span class="lineNum">     889 </span>                :            :                 }
<span class="lineNum">     890 </span>                :            : 
<span class="lineNum">     891 </span>                :<span class="lineNoCov">          0 :                 traced[fullName] = true;</span>
<span class="lineNum">     892 </span>                :            :             }
<span class="lineNum">     893 </span>                :            : 
<span class="lineNum">     894 </span>                :            :             //Trace through the dependencies.
<span class="lineNum">     895 </span>                :<span class="lineNoCov">          0 :             if (depArray) {</span>
<span class="lineNum">     896 </span>                :<span class="lineNoCov">          0 :                 for (i = 0; i &lt; depArray.length; i++) {</span>
<span class="lineNum">     897 </span>                :            :                     //Some array members may be null, like if a trailing comma
<span class="lineNum">     898 </span>                :            :                     //IE, so do the explicit [i] access and check if it has a value.
<span class="lineNum">     899 </span>                :<span class="lineNoCov">          0 :                     depName = depArray[i];</span>
<span class="lineNum">     900 </span>                :<span class="lineNoCov">          0 :                     if (depName) {</span>
<span class="lineNum">     901 </span>                :            :                         //First, make sure if it is a plugin resource that the
<span class="lineNum">     902 </span>                :            :                         //plugin is not blocked.
<span class="lineNum">     903 </span>                :<span class="lineNoCov">          0 :                         prefix = makeModuleMap(depName).prefix;</span>
<span class="lineNum">     904 </span>                :<span class="lineNoCov">          0 :                         if (prefix &amp;&amp; (prefixManager = waiting[prefix])) {</span>
<span class="lineNum">     905 </span>                :<span class="lineNoCov">          0 :                             forceExec(prefixManager, traced);</span>
<span class="lineNum">     906 </span>                :            :                         }
<span class="lineNum">     907 </span>                :<span class="lineNoCov">          0 :                         depManager = waiting[depName];</span>
<span class="lineNum">     908 </span>                :<span class="lineNoCov">          0 :                         if (depManager &amp;&amp; !depManager.isDone &amp;&amp; loaded[depName]) {</span>
<span class="lineNum">     909 </span>                :<span class="lineNoCov">          0 :                             value = forceExec(depManager, traced);</span>
<span class="lineNum">     910 </span>                :<span class="lineNoCov">          0 :                             manager.depCallbacks[i](value);</span>
<span class="lineNum">     911 </span>                :            :                         }
<span class="lineNum">     912 </span>                :            :                     }
<span class="lineNum">     913 </span>                :            :                 }
<span class="lineNum">     914 </span>                :            :             }
<span class="lineNum">     915 </span>                :            : 
<span class="lineNum">     916 </span>                :<span class="lineNoCov">          0 :             return fullName ? defined[fullName] : undefined;</span>
<span class="lineNum">     917 </span>                :            :         }
<span class="lineNum">     918 </span>                :            : 
<span class="lineNum">     919 </span>                :            :         /**
<span class="lineNum">     920 </span>                :            :          * Checks if all modules for a context are loaded, and if so, evaluates the
<span class="lineNum">     921 </span>                :            :          * new ones in right dependency order.
<span class="lineNum">     922 </span>                :            :          *
<span class="lineNum">     923 </span>                :            :          * @private
<span class="lineNum">     924 </span>                :            :          */
<span class="lineNum">     925 </span>                :<span class="lineCov">          1 :         function checkLoaded() {</span>
<span class="lineNum">     926 </span>                :<span class="lineCov">          1 :             var waitInterval = config.waitSeconds * 1000,</span>
<span class="lineNum">     927 </span>                :            :                 //It is possible to disable the wait interval by using waitSeconds of 0.
<span class="lineNum">     928 </span>                :            :                 expired = waitInterval &amp;&amp; (context.startTime + waitInterval) &lt; new Date().getTime(),
<span class="lineNum">     929 </span>                :            :                 noLoads = &quot;&quot;, hasLoadedProp = false, stillLoading = false, prop,
<span class="lineNum">     930 </span>                :            :                 err, manager;
<span class="lineNum">     931 </span>                :            : 
<span class="lineNum">     932 </span>                :            :             //If there are items still in the paused queue processing wait.
<span class="lineNum">     933 </span>                :            :             //This is particularly important in the sync case where each paused
<span class="lineNum">     934 </span>                :            :             //item is processed right away but there may be more waiting.
<span class="lineNum">     935 </span>                :<span class="lineCov">          1 :             if (context.pausedCount &gt; 0) {</span>
<span class="lineNum">     936 </span>                :<span class="lineNoCov">          0 :                 return undefined;</span>
<span class="lineNum">     937 </span>                :            :             }
<span class="lineNum">     938 </span>                :            : 
<span class="lineNum">     939 </span>                :            :             //Determine if priority loading is done. If so clear the priority. If
<span class="lineNum">     940 </span>                :            :             //not, then do not check
<span class="lineNum">     941 </span>                :<span class="lineCov">          1 :             if (config.priorityWait) {</span>
<span class="lineNum">     942 </span>                :<span class="lineNoCov">          0 :                 if (isPriorityDone()) {</span>
<span class="lineNum">     943 </span>                :            :                     //Call resume, since it could have
<span class="lineNum">     944 </span>                :            :                     //some waiting dependencies to trace.
<span class="lineNum">     945 </span>                :<span class="lineNoCov">          0 :                     resume();</span>
<span class="lineNum">     946 </span>                :            :                 } else {
<span class="lineNum">     947 </span>                :<span class="lineNoCov">          0 :                     return undefined;</span>
<span class="lineNum">     948 </span>                :            :                 }
<span class="lineNum">     949 </span>                :            :             }
<span class="lineNum">     950 </span>                :            : 
<span class="lineNum">     951 </span>                :            :             //See if anything is still in flight.
<span class="lineNum">     952 </span>                :<span class="lineCov">          1 :             for (prop in loaded) {</span>
<span class="lineNum">     953 </span>                :<span class="lineNoCov">          0 :                 if (!(prop in empty)) {</span>
<span class="lineNum">     954 </span>                :<span class="lineNoCov">          0 :                     hasLoadedProp = true;</span>
<span class="lineNum">     955 </span>                :<span class="lineNoCov">          0 :                     if (!loaded[prop]) {</span>
<span class="lineNum">     956 </span>                :<span class="lineNoCov">          0 :                         if (expired) {</span>
<span class="lineNum">     957 </span>                :<span class="lineNoCov">          0 :                             noLoads += prop + &quot; &quot;;</span>
<span class="lineNum">     958 </span>                :            :                         } else {
<span class="lineNum">     959 </span>                :<span class="lineNoCov">          0 :                             stillLoading = true;</span>
<span class="lineNum">     960 </span>                :<span class="lineNoCov">          0 :                             break;</span>
<span class="lineNum">     961 </span>                :            :                         }
<span class="lineNum">     962 </span>                :            :                     }
<span class="lineNum">     963 </span>                :            :                 }
<span class="lineNum">     964 </span>                :            :             }
<span class="lineNum">     965 </span>                :            : 
<span class="lineNum">     966 </span>                :            :             //Check for exit conditions.
<span class="lineNum">     967 </span>                :<span class="lineCov">          1 :             if (!hasLoadedProp &amp;&amp; !context.waitCount) {</span>
<span class="lineNum">     968 </span>                :            :                 //If the loaded object had no items, then the rest of
<span class="lineNum">     969 </span>                :            :                 //the work below does not need to be done.
<span class="lineNum">     970 </span>                :<span class="lineCov">          1 :                 return undefined;</span>
<span class="lineNum">     971 </span>                :            :             }
<span class="lineNum">     972 </span>                :<span class="lineNoCov">          0 :             if (expired &amp;&amp; noLoads) {</span>
<span class="lineNum">     973 </span>                :            :                 //If wait time expired, throw error of unloaded modules.
<span class="lineNum">     974 </span>                :<span class="lineNoCov">          0 :                 err = makeError(&quot;timeout&quot;, &quot;Load timeout for modules: &quot; + noLoads);</span>
<span class="lineNum">     975 </span>                :<span class="lineNoCov">          0 :                 err.requireType = &quot;timeout&quot;;</span>
<span class="lineNum">     976 </span>                :<span class="lineNoCov">          0 :                 err.requireModules = noLoads;</span>
<span class="lineNum">     977 </span>                :<span class="lineNoCov">          0 :                 return req.onError(err);</span>
<span class="lineNum">     978 </span>                :            :             }
<span class="lineNum">     979 </span>                :<span class="lineNoCov">          0 :             if (stillLoading || context.scriptCount) {</span>
<span class="lineNum">     980 </span>                :            :                 //Something is still waiting to load. Wait for it, but only
<span class="lineNum">     981 </span>                :            :                 //if a timeout is not already in effect.
<span class="lineNum">     982 </span>                :<span class="lineNoCov">          0 :                 if ((isBrowser || isWebWorker) &amp;&amp; !checkLoadedTimeoutId) {</span>
<span class="lineNum">     983 </span>                :<span class="lineNoCov">          0 :                     checkLoadedTimeoutId = setTimeout(function () {</span>
<span class="lineNum">     984 </span>                :<span class="lineNoCov">          0 :                         checkLoadedTimeoutId = 0;</span>
<span class="lineNum">     985 </span>                :<span class="lineNoCov">          0 :                         checkLoaded();</span>
<span class="lineNum">     986 </span>                :            :                     }, 50);
<span class="lineNum">     987 </span>                :            :                 }
<span class="lineNum">     988 </span>                :<span class="lineNoCov">          0 :                 return undefined;</span>
<span class="lineNum">     989 </span>                :            :             }
<span class="lineNum">     990 </span>                :            : 
<span class="lineNum">     991 </span>                :            :             //If still have items in the waiting cue, but all modules have
<span class="lineNum">     992 </span>                :            :             //been loaded, then it means there are some circular dependencies
<span class="lineNum">     993 </span>                :            :             //that need to be broken.
<span class="lineNum">     994 </span>                :            :             //However, as a waiting thing is fired, then it can add items to
<span class="lineNum">     995 </span>                :            :             //the waiting cue, and those items should not be fired yet, so
<span class="lineNum">     996 </span>                :            :             //make sure to redo the checkLoaded call after breaking a single
<span class="lineNum">     997 </span>                :            :             //cycle, if nothing else loaded then this logic will pick it up
<span class="lineNum">     998 </span>                :            :             //again.
<span class="lineNum">     999 </span>                :<span class="lineNoCov">          0 :             if (context.waitCount) {</span>
<span class="lineNum">    1000 </span>                :            :                 //Cycle through the waitAry, and call items in sequence.
<span class="lineNum">    1001 </span>                :<span class="lineNoCov">          0 :                 for (i = 0; (manager = waitAry[i]); i++) {</span>
<span class="lineNum">    1002 </span>                :<span class="lineNoCov">          0 :                     forceExec(manager, {});</span>
<span class="lineNum">    1003 </span>                :            :                 }
<span class="lineNum">    1004 </span>                :            : 
<span class="lineNum">    1005 </span>                :            :                 //If anything got placed in the paused queue, run it down.
<span class="lineNum">    1006 </span>                :<span class="lineNoCov">          0 :                 if (context.paused.length) {</span>
<span class="lineNum">    1007 </span>                :<span class="lineNoCov">          0 :                     resume();</span>
<span class="lineNum">    1008 </span>                :            :                 }
<span class="lineNum">    1009 </span>                :            : 
<span class="lineNum">    1010 </span>                :            :                 //Only allow this recursion to a certain depth. Only
<span class="lineNum">    1011 </span>                :            :                 //triggered by errors in calling a module in which its
<span class="lineNum">    1012 </span>                :            :                 //modules waiting on it cannot finish loading, or some circular
<span class="lineNum">    1013 </span>                :            :                 //dependencies that then may add more dependencies.
<span class="lineNum">    1014 </span>                :            :                 //The value of 5 is a bit arbitrary. Hopefully just one extra
<span class="lineNum">    1015 </span>                :            :                 //pass, or two for the case of circular dependencies generating
<span class="lineNum">    1016 </span>                :            :                 //more work that gets resolved in the sync node case.
<span class="lineNum">    1017 </span>                :<span class="lineNoCov">          0 :                 if (checkLoadedDepth &lt; 5) {</span>
<span class="lineNum">    1018 </span>                :<span class="lineNoCov">          0 :                     checkLoadedDepth += 1;</span>
<span class="lineNum">    1019 </span>                :<span class="lineNoCov">          0 :                     checkLoaded();</span>
<span class="lineNum">    1020 </span>                :            :                 }
<span class="lineNum">    1021 </span>                :            :             }
<span class="lineNum">    1022 </span>                :            : 
<span class="lineNum">    1023 </span>                :<span class="lineNoCov">          0 :             checkLoadedDepth = 0;</span>
<span class="lineNum">    1024 </span>                :            : 
<span class="lineNum">    1025 </span>                :            :             //Check for DOM ready, and nothing is waiting across contexts.
<span class="lineNum">    1026 </span>                :<span class="lineNoCov">          0 :             req.checkReadyState();</span>
<span class="lineNum">    1027 </span>                :            : 
<span class="lineNum">    1028 </span>                :<span class="lineNoCov">          0 :             return undefined;</span>
<span class="lineNum">    1029 </span>                :            :         }
<span class="lineNum">    1030 </span>                :            : 
<span class="lineNum">    1031 </span>                :            :         /**
<span class="lineNum">    1032 </span>                :            :          * Resumes tracing of dependencies and then checks if everything is loaded.
<span class="lineNum">    1033 </span>                :            :          */
<span class="lineNum">    1034 </span>                :<span class="lineCov">          1 :         resume = function () {</span>
<span class="lineNum">    1035 </span>                :<span class="lineCov">          3 :             var manager, map, url, i, p, args, fullName;</span>
<span class="lineNum">    1036 </span>                :            : 
<span class="lineNum">    1037 </span>                :<span class="lineCov">          3 :             resumeDepth += 1;</span>
<span class="lineNum">    1038 </span>                :            : 
<span class="lineNum">    1039 </span>                :<span class="lineCov">          3 :             if (context.scriptCount &lt;= 0) {</span>
<span class="lineNum">    1040 </span>                :            :                 //Synchronous envs will push the number below zero with the
<span class="lineNum">    1041 </span>                :            :                 //decrement above, be sure to set it back to zero for good measure.
<span class="lineNum">    1042 </span>                :            :                 //require() calls that also do not end up loading scripts could
<span class="lineNum">    1043 </span>                :            :                 //push the number negative too.
<span class="lineNum">    1044 </span>                :<span class="lineCov">          3 :                 context.scriptCount = 0;</span>
<span class="lineNum">    1045 </span>                :            :             }
<span class="lineNum">    1046 </span>                :            : 
<span class="lineNum">    1047 </span>                :            :             //Make sure any remaining defQueue items get properly processed.
<span class="lineNum">    1048 </span>                :<span class="lineCov">          3 :             while (defQueue.length) {</span>
<span class="lineNum">    1049 </span>                :<span class="lineCov">          3 :                 args = defQueue.shift();</span>
<span class="lineNum">    1050 </span>                :<span class="lineCov">          3 :                 if (args[0] === null) {</span>
<span class="lineNum">    1051 </span>                :<span class="lineCov">          2 :                     return req.onError(makeError('mismatch', 'Mismatched anonymous define() module: ' + args[args.length - 1]));</span>
<span class="lineNum">    1052 </span>                :            :                 } else {
<span class="lineNum">    1053 </span>                :<span class="lineCov">          1 :                     callDefMain(args);</span>
<span class="lineNum">    1054 </span>                :            :                 }
<span class="lineNum">    1055 </span>                :            :             }
<span class="lineNum">    1056 </span>                :            : 
<span class="lineNum">    1057 </span>                :            :             //Skip the resume of paused dependencies
<span class="lineNum">    1058 </span>                :            :             //if current context is in priority wait.
<span class="lineNum">    1059 </span>                :<span class="lineCov">          1 :             if (!config.priorityWait || isPriorityDone()) {</span>
<span class="lineNum">    1060 </span>                :<span class="lineCov">          1 :                 while (context.paused.length) {</span>
<span class="lineNum">    1061 </span>                :<span class="lineNoCov">          0 :                     p = context.paused;</span>
<span class="lineNum">    1062 </span>                :<span class="lineNoCov">          0 :                     context.pausedCount += p.length;</span>
<span class="lineNum">    1063 </span>                :            :                     //Reset paused list
<span class="lineNum">    1064 </span>                :<span class="lineNoCov">          0 :                     context.paused = [];</span>
<span class="lineNum">    1065 </span>                :            : 
<span class="lineNum">    1066 </span>                :<span class="lineNoCov">          0 :                     for (i = 0; (manager = p[i]); i++) {</span>
<span class="lineNum">    1067 </span>                :<span class="lineNoCov">          0 :                         map = manager.map;</span>
<span class="lineNum">    1068 </span>                :<span class="lineNoCov">          0 :                         url = map.url;</span>
<span class="lineNum">    1069 </span>                :<span class="lineNoCov">          0 :                         fullName = map.fullName;</span>
<span class="lineNum">    1070 </span>                :            : 
<span class="lineNum">    1071 </span>                :            :                         //If the manager is for a plugin managed resource,
<span class="lineNum">    1072 </span>                :            :                         //ask the plugin to load it now.
<span class="lineNum">    1073 </span>                :<span class="lineNoCov">          0 :                         if (map.prefix) {</span>
<span class="lineNum">    1074 </span>                :<span class="lineNoCov">          0 :                             callPlugin(map.prefix, manager);</span>
<span class="lineNum">    1075 </span>                :            :                         } else {
<span class="lineNum">    1076 </span>                :            :                             //Regular dependency.
<span class="lineNum">    1077 </span>                :<span class="lineNoCov">          0 :                             if (!urlFetched[url] &amp;&amp; !loaded[fullName]) {</span>
<span class="lineNum">    1078 </span>                :<span class="lineNoCov">          0 :                                 req.load(context, fullName, url);</span>
<span class="lineNum">    1079 </span>                :            : 
<span class="lineNum">    1080 </span>                :            :                                 //Mark the URL as fetched, but only if it is
<span class="lineNum">    1081 </span>                :            :                                 //not an empty: URL, used by the optimizer.
<span class="lineNum">    1082 </span>                :            :                                 //In that case we need to be sure to call
<span class="lineNum">    1083 </span>                :            :                                 //load() for each module that is mapped to
<span class="lineNum">    1084 </span>                :            :                                 //empty: so that dependencies are satisfied
<span class="lineNum">    1085 </span>                :            :                                 //correctly.
<span class="lineNum">    1086 </span>                :<span class="lineNoCov">          0 :                                 if (url.indexOf('empty:') !== 0) {</span>
<span class="lineNum">    1087 </span>                :<span class="lineNoCov">          0 :                                     urlFetched[url] = true;</span>
<span class="lineNum">    1088 </span>                :            :                                 }
<span class="lineNum">    1089 </span>                :            :                             }
<span class="lineNum">    1090 </span>                :            :                         }
<span class="lineNum">    1091 </span>                :            :                     }
<span class="lineNum">    1092 </span>                :            : 
<span class="lineNum">    1093 </span>                :            :                     //Move the start time for timeout forward.
<span class="lineNum">    1094 </span>                :<span class="lineNoCov">          0 :                     context.startTime = (new Date()).getTime();</span>
<span class="lineNum">    1095 </span>                :<span class="lineNoCov">          0 :                     context.pausedCount -= p.length;</span>
<span class="lineNum">    1096 </span>                :            :                 }
<span class="lineNum">    1097 </span>                :            :             }
<span class="lineNum">    1098 </span>                :            : 
<span class="lineNum">    1099 </span>                :            :             //Only check if loaded when resume depth is 1. It is likely that
<span class="lineNum">    1100 </span>                :            :             //it is only greater than 1 in sync environments where a factory
<span class="lineNum">    1101 </span>                :            :             //function also then calls the callback-style require. In those
<span class="lineNum">    1102 </span>                :            :             //cases, the checkLoaded should not occur until the resume
<span class="lineNum">    1103 </span>                :            :             //depth is back at the top level.
<span class="lineNum">    1104 </span>                :<span class="lineCov">          1 :             if (resumeDepth === 1) {</span>
<span class="lineNum">    1105 </span>                :<span class="lineCov">          1 :                 checkLoaded();</span>
<span class="lineNum">    1106 </span>                :            :             }
<span class="lineNum">    1107 </span>                :            : 
<span class="lineNum">    1108 </span>                :<span class="lineCov">          1 :             resumeDepth -= 1;</span>
<span class="lineNum">    1109 </span>                :            : 
<span class="lineNum">    1110 </span>                :<span class="lineCov">          1 :             return undefined;</span>
<span class="lineNum">    1111 </span>                :            :         };
<span class="lineNum">    1112 </span>                :            : 
<span class="lineNum">    1113 </span>                :            :         //Define the context object. Many of these fields are on here
<span class="lineNum">    1114 </span>                :            :         //just to make debugging easier.
<span class="lineNum">    1115 </span>                :<span class="lineCov">          1 :         context = {</span>
<span class="lineNum">    1116 </span>                :            :             contextName: contextName,
<span class="lineNum">    1117 </span>                :            :             config: config,
<span class="lineNum">    1118 </span>                :            :             defQueue: defQueue,
<span class="lineNum">    1119 </span>                :            :             waiting: waiting,
<span class="lineNum">    1120 </span>                :            :             waitCount: 0,
<span class="lineNum">    1121 </span>                :            :             specified: specified,
<span class="lineNum">    1122 </span>                :            :             loaded: loaded,
<span class="lineNum">    1123 </span>                :            :             urlMap: urlMap,
<span class="lineNum">    1124 </span>                :            :             urlFetched: urlFetched,
<span class="lineNum">    1125 </span>                :            :             scriptCount: 0,
<span class="lineNum">    1126 </span>                :            :             defined: defined,
<span class="lineNum">    1127 </span>                :            :             paused: [],
<span class="lineNum">    1128 </span>                :            :             pausedCount: 0,
<span class="lineNum">    1129 </span>                :            :             plugins: plugins,
<span class="lineNum">    1130 </span>                :            :             needFullExec: needFullExec,
<span class="lineNum">    1131 </span>                :            :             fake: {},
<span class="lineNum">    1132 </span>                :            :             fullExec: fullExec,
<span class="lineNum">    1133 </span>                :            :             managerCallbacks: managerCallbacks,
<span class="lineNum">    1134 </span>                :            :             makeModuleMap: makeModuleMap,
<span class="lineNum">    1135 </span>                :            :             normalize: normalize,
<span class="lineNum">    1136 </span>                :            :             /**
<span class="lineNum">    1137 </span>                :            :              * Set a configuration for the context.
<span class="lineNum">    1138 </span>                :            :              * @param {Object} cfg config object to integrate.
<span class="lineNum">    1139 </span>                :            :              */
<span class="lineNum">    1140 </span>                :            :             configure: function (cfg) {
<span class="lineNum">    1141 </span>                :<span class="lineCov">          1 :                 var paths, prop, packages, pkgs, packagePaths, requireWait;</span>
<span class="lineNum">    1142 </span>                :            : 
<span class="lineNum">    1143 </span>                :            :                 //Make sure the baseUrl ends in a slash.
<span class="lineNum">    1144 </span>                :<span class="lineCov">          1 :                 if (cfg.baseUrl) {</span>
<span class="lineNum">    1145 </span>                :<span class="lineNoCov">          0 :                     if (cfg.baseUrl.charAt(cfg.baseUrl.length - 1) !== &quot;/&quot;) {</span>
<span class="lineNum">    1146 </span>                :<span class="lineNoCov">          0 :                         cfg.baseUrl += &quot;/&quot;;</span>
<span class="lineNum">    1147 </span>                :            :                     }
<span class="lineNum">    1148 </span>                :            :                 }
<span class="lineNum">    1149 </span>                :            : 
<span class="lineNum">    1150 </span>                :            :                 //Save off the paths and packages since they require special processing,
<span class="lineNum">    1151 </span>                :            :                 //they are additive.
<span class="lineNum">    1152 </span>                :<span class="lineCov">          1 :                 paths = config.paths;</span>
<span class="lineNum">    1153 </span>                :<span class="lineCov">          1 :                 packages = config.packages;</span>
<span class="lineNum">    1154 </span>                :<span class="lineCov">          1 :                 pkgs = config.pkgs;</span>
<span class="lineNum">    1155 </span>                :            : 
<span class="lineNum">    1156 </span>                :            :                 //Mix in the config values, favoring the new values over
<span class="lineNum">    1157 </span>                :            :                 //existing ones in context.config.
<span class="lineNum">    1158 </span>                :<span class="lineCov">          1 :                 mixin(config, cfg, true);</span>
<span class="lineNum">    1159 </span>                :            : 
<span class="lineNum">    1160 </span>                :            :                 //Adjust paths if necessary.
<span class="lineNum">    1161 </span>                :<span class="lineCov">          1 :                 if (cfg.paths) {</span>
<span class="lineNum">    1162 </span>                :<span class="lineNoCov">          0 :                     for (prop in cfg.paths) {</span>
<span class="lineNum">    1163 </span>                :<span class="lineNoCov">          0 :                         if (!(prop in empty)) {</span>
<span class="lineNum">    1164 </span>                :<span class="lineNoCov">          0 :                             paths[prop] = cfg.paths[prop];</span>
<span class="lineNum">    1165 </span>                :            :                         }
<span class="lineNum">    1166 </span>                :            :                     }
<span class="lineNum">    1167 </span>                :<span class="lineNoCov">          0 :                     config.paths = paths;</span>
<span class="lineNum">    1168 </span>                :            :                 }
<span class="lineNum">    1169 </span>                :            : 
<span class="lineNum">    1170 </span>                :<span class="lineCov">          1 :                 packagePaths = cfg.packagePaths;</span>
<span class="lineNum">    1171 </span>                :<span class="lineCov">          1 :                 if (packagePaths || cfg.packages) {</span>
<span class="lineNum">    1172 </span>                :            :                     //Convert packagePaths into a packages config.
<span class="lineNum">    1173 </span>                :<span class="lineNoCov">          0 :                     if (packagePaths) {</span>
<span class="lineNum">    1174 </span>                :<span class="lineNoCov">          0 :                         for (prop in packagePaths) {</span>
<span class="lineNum">    1175 </span>                :<span class="lineNoCov">          0 :                             if (!(prop in empty)) {</span>
<span class="lineNum">    1176 </span>                :<span class="lineNoCov">          0 :                                 configurePackageDir(pkgs, packagePaths[prop], prop);</span>
<span class="lineNum">    1177 </span>                :            :                             }
<span class="lineNum">    1178 </span>                :            :                         }
<span class="lineNum">    1179 </span>                :            :                     }
<span class="lineNum">    1180 </span>                :            : 
<span class="lineNum">    1181 </span>                :            :                     //Adjust packages if necessary.
<span class="lineNum">    1182 </span>                :<span class="lineNoCov">          0 :                     if (cfg.packages) {</span>
<span class="lineNum">    1183 </span>                :<span class="lineNoCov">          0 :                         configurePackageDir(pkgs, cfg.packages);</span>
<span class="lineNum">    1184 </span>                :            :                     }
<span class="lineNum">    1185 </span>                :            : 
<span class="lineNum">    1186 </span>                :            :                     //Done with modifications, assing packages back to context config
<span class="lineNum">    1187 </span>                :<span class="lineNoCov">          0 :                     config.pkgs = pkgs;</span>
<span class="lineNum">    1188 </span>                :            :                 }
<span class="lineNum">    1189 </span>                :            : 
<span class="lineNum">    1190 </span>                :            :                 //If priority loading is in effect, trigger the loads now
<span class="lineNum">    1191 </span>                :<span class="lineCov">          1 :                 if (cfg.priority) {</span>
<span class="lineNum">    1192 </span>                :            :                     //Hold on to requireWait value, and reset it after done
<span class="lineNum">    1193 </span>                :<span class="lineNoCov">          0 :                     requireWait = context.requireWait;</span>
<span class="lineNum">    1194 </span>                :            : 
<span class="lineNum">    1195 </span>                :            :                     //Allow tracing some require calls to allow the fetching
<span class="lineNum">    1196 </span>                :            :                     //of the priority config.
<span class="lineNum">    1197 </span>                :<span class="lineNoCov">          0 :                     context.requireWait = false;</span>
<span class="lineNum">    1198 </span>                :            :                     //But first, call resume to register any defined modules that may
<span class="lineNum">    1199 </span>                :            :                     //be in a data-main built file before the priority config
<span class="lineNum">    1200 </span>                :            :                     //call. Also grab any waiting define calls for this context.
<span class="lineNum">    1201 </span>                :<span class="lineNoCov">          0 :                     context.takeGlobalQueue();</span>
<span class="lineNum">    1202 </span>                :<span class="lineNoCov">          0 :                     resume();</span>
<span class="lineNum">    1203 </span>                :            : 
<span class="lineNum">    1204 </span>                :<span class="lineNoCov">          0 :                     context.require(cfg.priority);</span>
<span class="lineNum">    1205 </span>                :            : 
<span class="lineNum">    1206 </span>                :            :                     //Trigger a resume right away, for the case when
<span class="lineNum">    1207 </span>                :            :                     //the script with the priority load is done as part
<span class="lineNum">    1208 </span>                :            :                     //of a data-main call. In that case the normal resume
<span class="lineNum">    1209 </span>                :            :                     //call will not happen because the scriptCount will be
<span class="lineNum">    1210 </span>                :            :                     //at 1, since the script for data-main is being processed.
<span class="lineNum">    1211 </span>                :<span class="lineNoCov">          0 :                     resume();</span>
<span class="lineNum">    1212 </span>                :            : 
<span class="lineNum">    1213 </span>                :            :                     //Restore previous state.
<span class="lineNum">    1214 </span>                :<span class="lineNoCov">          0 :                     context.requireWait = requireWait;</span>
<span class="lineNum">    1215 </span>                :<span class="lineNoCov">          0 :                     config.priorityWait = cfg.priority;</span>
<span class="lineNum">    1216 </span>                :            :                 }
<span class="lineNum">    1217 </span>                :            : 
<span class="lineNum">    1218 </span>                :            :                 //If a deps array or a config callback is specified, then call
<span class="lineNum">    1219 </span>                :            :                 //require with those args. This is useful when require is defined as a
<span class="lineNum">    1220 </span>                :            :                 //config object before require.js is loaded.
<span class="lineNum">    1221 </span>                :<span class="lineCov">          1 :                 if (cfg.deps || cfg.callback) {</span>
<span class="lineNum">    1222 </span>                :<span class="lineNoCov">          0 :                     context.require(cfg.deps || [], cfg.callback);</span>
<span class="lineNum">    1223 </span>                :            :                 }
<span class="lineNum">    1224 </span>                :            :             },
<span class="lineNum">    1225 </span>                :            : 
<span class="lineNum">    1226 </span>                :            :             requireDefined: function (moduleName, relModuleMap) {
<span class="lineNum">    1227 </span>                :<span class="lineNoCov">          0 :                 return makeModuleMap(moduleName, relModuleMap).fullName in defined;</span>
<span class="lineNum">    1228 </span>                :            :             },
<span class="lineNum">    1229 </span>                :            : 
<span class="lineNum">    1230 </span>                :            :             requireSpecified: function (moduleName, relModuleMap) {
<span class="lineNum">    1231 </span>                :<span class="lineNoCov">          0 :                 return makeModuleMap(moduleName, relModuleMap).fullName in specified;</span>
<span class="lineNum">    1232 </span>                :            :             },
<span class="lineNum">    1233 </span>                :            : 
<span class="lineNum">    1234 </span>                :            :             require: function (deps, callback, relModuleMap) {
<span class="lineNum">    1235 </span>                :<span class="lineCov">          3 :                 var moduleName, fullName, moduleMap;</span>
<span class="lineNum">    1236 </span>                :<span class="lineCov">          3 :                 if (typeof deps === &quot;string&quot;) {</span>
<span class="lineNum">    1237 </span>                :<span class="lineNoCov">          0 :                     if (isFunction(callback)) {</span>
<span class="lineNum">    1238 </span>                :            :                         //Invalid call
<span class="lineNum">    1239 </span>                :<span class="lineNoCov">          0 :                         return req.onError(makeError(&quot;requireargs&quot;, &quot;Invalid require call&quot;));</span>
<span class="lineNum">    1240 </span>                :            :                     }
<span class="lineNum">    1241 </span>                :            : 
<span class="lineNum">    1242 </span>                :            :                     //Synchronous access to one module. If require.get is
<span class="lineNum">    1243 </span>                :            :                     //available (as in the Node adapter), prefer that.
<span class="lineNum">    1244 </span>                :            :                     //In this case deps is the moduleName and callback is
<span class="lineNum">    1245 </span>                :            :                     //the relModuleMap
<span class="lineNum">    1246 </span>                :<span class="lineNoCov">          0 :                     if (req.get) {</span>
<span class="lineNum">    1247 </span>                :<span class="lineNoCov">          0 :                         return req.get(context, deps, callback);</span>
<span class="lineNum">    1248 </span>                :            :                     }
<span class="lineNum">    1249 </span>                :            : 
<span class="lineNum">    1250 </span>                :            :                     //Just return the module wanted. In this scenario, the
<span class="lineNum">    1251 </span>                :            :                     //second arg (if passed) is just the relModuleMap.
<span class="lineNum">    1252 </span>                :<span class="lineNoCov">          0 :                     moduleName = deps;</span>
<span class="lineNum">    1253 </span>                :<span class="lineNoCov">          0 :                     relModuleMap = callback;</span>
<span class="lineNum">    1254 </span>                :            : 
<span class="lineNum">    1255 </span>                :            :                     //Normalize module name, if it contains . or ..
<span class="lineNum">    1256 </span>                :<span class="lineNoCov">          0 :                     moduleMap = makeModuleMap(moduleName, relModuleMap);</span>
<span class="lineNum">    1257 </span>                :<span class="lineNoCov">          0 :                     fullName = moduleMap.fullName;</span>
<span class="lineNum">    1258 </span>                :            : 
<span class="lineNum">    1259 </span>                :<span class="lineNoCov">          0 :                     if (!(fullName in defined)) {</span>
<span class="lineNum">    1260 </span>                :<span class="lineNoCov">          0 :                         return req.onError(makeError(&quot;notloaded&quot;, &quot;Module name '&quot; +</span>
<span class="lineNum">    1261 </span>                :            :                                     moduleMap.fullName +
<span class="lineNum">    1262 </span>                :            :                                     &quot;' has not been loaded yet for context: &quot; +
<span class="lineNum">    1263 </span>                :            :                                     contextName));
<span class="lineNum">    1264 </span>                :            :                     }
<span class="lineNum">    1265 </span>                :<span class="lineNoCov">          0 :                     return defined[fullName];</span>
<span class="lineNum">    1266 </span>                :            :                 }
<span class="lineNum">    1267 </span>                :            : 
<span class="lineNum">    1268 </span>                :            :                 //Call main but only if there are dependencies or
<span class="lineNum">    1269 </span>                :            :                 //a callback to call.
<span class="lineNum">    1270 </span>                :<span class="lineCov">          3 :                 if (deps &amp;&amp; deps.length || callback) {</span>
<span class="lineNum">    1271 </span>                :<span class="lineCov">          2 :                     main(null, deps, callback, relModuleMap);</span>
<span class="lineNum">    1272 </span>                :            :                 }
<span class="lineNum">    1273 </span>                :            : 
<span class="lineNum">    1274 </span>                :            :                 //If the require call does not trigger anything new to load,
<span class="lineNum">    1275 </span>                :            :                 //then resume the dependency processing.
<span class="lineNum">    1276 </span>                :<span class="lineCov">          3 :                 if (!context.requireWait) {</span>
<span class="lineNum">    1277 </span>                :<span class="lineCov">          3 :                     while (!context.scriptCount &amp;&amp; context.paused.length) {</span>
<span class="lineNum">    1278 </span>                :            :                         //For built layers, there can be some defined
<span class="lineNum">    1279 </span>                :            :                         //modules waiting for intake into the context,
<span class="lineNum">    1280 </span>                :            :                         //in particular module plugins. Take them.
<span class="lineNum">    1281 </span>                :<span class="lineCov">          2 :                         context.takeGlobalQueue();</span>
<span class="lineNum">    1282 </span>                :<span class="lineCov">          2 :                         resume();</span>
<span class="lineNum">    1283 </span>                :            :                     }
<span class="lineNum">    1284 </span>                :            :                 }
<span class="lineNum">    1285 </span>                :<span class="lineCov">          1 :                 return context.require;</span>
<span class="lineNum">    1286 </span>                :            :             },
<span class="lineNum">    1287 </span>                :            : 
<span class="lineNum">    1288 </span>                :            :             /**
<span class="lineNum">    1289 </span>                :            :              * Internal method to transfer globalQueue items to this context's
<span class="lineNum">    1290 </span>                :            :              * defQueue.
<span class="lineNum">    1291 </span>                :            :              */
<span class="lineNum">    1292 </span>                :            :             takeGlobalQueue: function () {
<span class="lineNum">    1293 </span>                :            :                 //Push all the globalDefQueue items into the context's defQueue
<span class="lineNum">    1294 </span>                :<span class="lineCov">          3 :                 if (globalDefQueue.length) {</span>
<span class="lineNum">    1295 </span>                :            :                     //Array splice in the values since the context code has a
<span class="lineNum">    1296 </span>                :            :                     //local var ref to defQueue, so cannot just reassign the one
<span class="lineNum">    1297 </span>                :            :                     //on context.
<span class="lineNum">    1298 </span>                :<span class="lineCov">          1 :                     apsp.apply(context.defQueue,</span>
<span class="lineNum">    1299 </span>                :            :                                [context.defQueue.length - 1, 0].concat(globalDefQueue));
<span class="lineNum">    1300 </span>                :<span class="lineCov">          1 :                     globalDefQueue = [];</span>
<span class="lineNum">    1301 </span>                :            :                 }
<span class="lineNum">    1302 </span>                :            :             },
<span class="lineNum">    1303 </span>                :            : 
<span class="lineNum">    1304 </span>                :            :             /**
<span class="lineNum">    1305 </span>                :            :              * Internal method used by environment adapters to complete a load event.
<span class="lineNum">    1306 </span>                :            :              * A load event could be a script load or just a load pass from a synchronous
<span class="lineNum">    1307 </span>                :            :              * load call.
<span class="lineNum">    1308 </span>                :            :              * @param {String} moduleName the name of the module to potentially complete.
<span class="lineNum">    1309 </span>                :            :              */
<span class="lineNum">    1310 </span>                :            :             completeLoad: function (moduleName) {
<span class="lineNum">    1311 </span>                :<span class="lineNoCov">          0 :                 var args;</span>
<span class="lineNum">    1312 </span>                :            : 
<span class="lineNum">    1313 </span>                :<span class="lineNoCov">          0 :                 context.takeGlobalQueue();</span>
<span class="lineNum">    1314 </span>                :            : 
<span class="lineNum">    1315 </span>                :<span class="lineNoCov">          0 :                 while (defQueue.length) {</span>
<span class="lineNum">    1316 </span>                :<span class="lineNoCov">          0 :                     args = defQueue.shift();</span>
<span class="lineNum">    1317 </span>                :            : 
<span class="lineNum">    1318 </span>                :<span class="lineNoCov">          0 :                     if (args[0] === null) {</span>
<span class="lineNum">    1319 </span>                :<span class="lineNoCov">          0 :                         args[0] = moduleName;</span>
<span class="lineNum">    1320 </span>                :<span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1321 </span>                :<span class="lineNoCov">          0 :                     } else if (args[0] === moduleName) {</span>
<span class="lineNum">    1322 </span>                :            :                         //Found matching define call for this script!
<span class="lineNum">    1323 </span>                :<span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1324 </span>                :            :                     } else {
<span class="lineNum">    1325 </span>                :            :                         //Some other named define call, most likely the result
<span class="lineNum">    1326 </span>                :            :                         //of a build layer that included many define calls.
<span class="lineNum">    1327 </span>                :<span class="lineNoCov">          0 :                         callDefMain(args);</span>
<span class="lineNum">    1328 </span>                :<span class="lineNoCov">          0 :                         args = null;</span>
<span class="lineNum">    1329 </span>                :            :                     }
<span class="lineNum">    1330 </span>                :            :                 }
<span class="lineNum">    1331 </span>                :<span class="lineNoCov">          0 :                 if (args) {</span>
<span class="lineNum">    1332 </span>                :<span class="lineNoCov">          0 :                     callDefMain(args);</span>
<span class="lineNum">    1333 </span>                :            :                 } else {
<span class="lineNum">    1334 </span>                :            :                     //A script that does not call define(), so just simulate
<span class="lineNum">    1335 </span>                :            :                     //the call for it. Special exception for jQuery dynamic load.
<span class="lineNum">    1336 </span>                :<span class="lineNoCov">          0 :                     callDefMain([moduleName, [],</span>
<span class="lineNum">    1337 </span>                :            :                                 moduleName === &quot;jquery&quot; &amp;&amp; typeof jQuery !== &quot;undefined&quot; ?
<span class="lineNum">    1338 </span>                :            :                                 function () {
<span class="lineNum">    1339 </span>                :<span class="lineNoCov">          0 :                                     return jQuery;</span>
<span class="lineNum">    1340 </span>                :            :                                 } : null]);
<span class="lineNum">    1341 </span>                :            :                 }
<span class="lineNum">    1342 </span>                :            : 
<span class="lineNum">    1343 </span>                :            :                 //Doing this scriptCount decrement branching because sync envs
<span class="lineNum">    1344 </span>                :            :                 //need to decrement after resume, otherwise it looks like
<span class="lineNum">    1345 </span>                :            :                 //loading is complete after the first dependency is fetched.
<span class="lineNum">    1346 </span>                :            :                 //For browsers, it works fine to decrement after, but it means
<span class="lineNum">    1347 </span>                :            :                 //the checkLoaded setTimeout 50 ms cost is taken. To avoid
<span class="lineNum">    1348 </span>                :            :                 //that cost, decrement beforehand.
<span class="lineNum">    1349 </span>                :<span class="lineNoCov">          0 :                 if (req.isAsync) {</span>
<span class="lineNum">    1350 </span>                :<span class="lineNoCov">          0 :                     context.scriptCount -= 1;</span>
<span class="lineNum">    1351 </span>                :            :                 }
<span class="lineNum">    1352 </span>                :<span class="lineNoCov">          0 :                 resume();</span>
<span class="lineNum">    1353 </span>                :<span class="lineNoCov">          0 :                 if (!req.isAsync) {</span>
<span class="lineNum">    1354 </span>                :<span class="lineNoCov">          0 :                     context.scriptCount -= 1;</span>
<span class="lineNum">    1355 </span>                :            :                 }
<span class="lineNum">    1356 </span>                :            :             },
<span class="lineNum">    1357 </span>                :            : 
<span class="lineNum">    1358 </span>                :            :             /**
<span class="lineNum">    1359 </span>                :            :              * Converts a module name + .extension into an URL path.
<span class="lineNum">    1360 </span>                :            :              * *Requires* the use of a module name. It does not support using
<span class="lineNum">    1361 </span>                :            :              * plain URLs like nameToUrl.
<span class="lineNum">    1362 </span>                :            :              */
<span class="lineNum">    1363 </span>                :            :             toUrl: function (moduleNamePlusExt, relModuleMap) {
<span class="lineNum">    1364 </span>                :<span class="lineNoCov">          0 :                 var index = moduleNamePlusExt.lastIndexOf(&quot;.&quot;),</span>
<span class="lineNum">    1365 </span>                :            :                     ext = null;
<span class="lineNum">    1366 </span>                :            : 
<span class="lineNum">    1367 </span>                :<span class="lineNoCov">          0 :                 if (index !== -1) {</span>
<span class="lineNum">    1368 </span>                :<span class="lineNoCov">          0 :                     ext = moduleNamePlusExt.substring(index, moduleNamePlusExt.length);</span>
<span class="lineNum">    1369 </span>                :<span class="lineNoCov">          0 :                     moduleNamePlusExt = moduleNamePlusExt.substring(0, index);</span>
<span class="lineNum">    1370 </span>                :            :                 }
<span class="lineNum">    1371 </span>                :            : 
<span class="lineNum">    1372 </span>                :<span class="lineNoCov">          0 :                 return context.nameToUrl(moduleNamePlusExt, ext, relModuleMap);</span>
<span class="lineNum">    1373 </span>                :            :             },
<span class="lineNum">    1374 </span>                :            : 
<span class="lineNum">    1375 </span>                :            :             /**
<span class="lineNum">    1376 </span>                :            :              * Converts a module name to a file path. Supports cases where
<span class="lineNum">    1377 </span>                :            :              * moduleName may actually be just an URL.
<span class="lineNum">    1378 </span>                :            :              */
<span class="lineNum">    1379 </span>                :            :             nameToUrl: function (moduleName, ext, relModuleMap) {
<span class="lineNum">    1380 </span>                :<span class="lineCov">          2 :                 var paths, pkgs, pkg, pkgPath, syms, i, parentModule, url,</span>
<span class="lineNum">    1381 </span>                :            :                     config = context.config;
<span class="lineNum">    1382 </span>                :            : 
<span class="lineNum">    1383 </span>                :            :                 //Normalize module name if have a base relative module name to work from.
<span class="lineNum">    1384 </span>                :<span class="lineCov">          2 :                 moduleName = normalize(moduleName, relModuleMap &amp;&amp; relModuleMap.fullName);</span>
<span class="lineNum">    1385 </span>                :            : 
<span class="lineNum">    1386 </span>                :            :                 //If a colon is in the URL, it indicates a protocol is used and it is just
<span class="lineNum">    1387 </span>                :            :                 //an URL to a file, or if it starts with a slash or ends with .js, it is just a plain file.
<span class="lineNum">    1388 </span>                :            :                 //The slash is important for protocol-less URLs as well as full paths.
<span class="lineNum">    1389 </span>                :<span class="lineCov">          2 :                 if (req.jsExtRegExp.test(moduleName)) {</span>
<span class="lineNum">    1390 </span>                :            :                     //Just a plain path, not module name lookup, so just return it.
<span class="lineNum">    1391 </span>                :            :                     //Add extension if it is included. This is a bit wonky, only non-.js things pass
<span class="lineNum">    1392 </span>                :            :                     //an extension, this method probably needs to be reworked.
<span class="lineNum">    1393 </span>                :<span class="lineNoCov">          0 :                     url = moduleName + (ext ? ext : &quot;&quot;);</span>
<span class="lineNum">    1394 </span>                :            :                 } else {
<span class="lineNum">    1395 </span>                :            :                     //A module that needs to be converted to a path.
<span class="lineNum">    1396 </span>                :<span class="lineCov">          2 :                     paths = config.paths;</span>
<span class="lineNum">    1397 </span>                :<span class="lineCov">          2 :                     pkgs = config.pkgs;</span>
<span class="lineNum">    1398 </span>                :            : 
<span class="lineNum">    1399 </span>                :<span class="lineCov">          2 :                     syms = moduleName.split(&quot;/&quot;);</span>
<span class="lineNum">    1400 </span>                :            :                     //For each module name segment, see if there is a path
<span class="lineNum">    1401 </span>                :            :                     //registered for it. Start with most specific name
<span class="lineNum">    1402 </span>                :            :                     //and work up from it.
<span class="lineNum">    1403 </span>                :<span class="lineCov">          2 :                     for (i = syms.length; i &gt; 0; i--) {</span>
<span class="lineNum">    1404 </span>                :<span class="lineCov">          4 :                         parentModule = syms.slice(0, i).join(&quot;/&quot;);</span>
<span class="lineNum">    1405 </span>                :<span class="lineCov">          4 :                         if (paths[parentModule]) {</span>
<span class="lineNum">    1406 </span>                :<span class="lineNoCov">          0 :                             syms.splice(0, i, paths[parentModule]);</span>
<span class="lineNum">    1407 </span>                :<span class="lineNoCov">          0 :                             break;</span>
<span class="lineNum">    1408 </span>                :<span class="lineCov">          4 :                         } else if ((pkg = pkgs[parentModule])) {</span>
<span class="lineNum">    1409 </span>                :            :                             //If module name is just the package name, then looking
<span class="lineNum">    1410 </span>                :            :                             //for the main module.
<span class="lineNum">    1411 </span>                :<span class="lineNoCov">          0 :                             if (moduleName === pkg.name) {</span>
<span class="lineNum">    1412 </span>                :<span class="lineNoCov">          0 :                                 pkgPath = pkg.location + '/' + pkg.main;</span>
<span class="lineNum">    1413 </span>                :            :                             } else {
<span class="lineNum">    1414 </span>                :<span class="lineNoCov">          0 :                                 pkgPath = pkg.location;</span>
<span class="lineNum">    1415 </span>                :            :                             }
<span class="lineNum">    1416 </span>                :<span class="lineNoCov">          0 :                             syms.splice(0, i, pkgPath);</span>
<span class="lineNum">    1417 </span>                :<span class="lineNoCov">          0 :                             break;</span>
<span class="lineNum">    1418 </span>                :            :                         }
<span class="lineNum">    1419 </span>                :            :                     }
<span class="lineNum">    1420 </span>                :            : 
<span class="lineNum">    1421 </span>                :            :                     //Join the path parts together, then figure out if baseUrl is needed.
<span class="lineNum">    1422 </span>                :<span class="lineCov">          2 :                     url = syms.join(&quot;/&quot;) + (ext || &quot;.js&quot;);</span>
<span class="lineNum">    1423 </span>                :<span class="lineCov">          2 :                     url = (url.charAt(0) === '/' || url.match(/^\w+:/) ? &quot;&quot; : config.baseUrl) + url;</span>
<span class="lineNum">    1424 </span>                :            :                 }
<span class="lineNum">    1425 </span>                :            : 
<span class="lineNum">    1426 </span>                :<span class="lineCov">          2 :                 return config.urlArgs ? url +</span>
<span class="lineNum">    1427 </span>                :            :                                         ((url.indexOf('?') === -1 ? '?' : '&amp;') +
<span class="lineNum">    1428 </span>                :            :                                          config.urlArgs) : url;
<span class="lineNum">    1429 </span>                :            :             }
<span class="lineNum">    1430 </span>                :            :         };
<span class="lineNum">    1431 </span>                :            : 
<span class="lineNum">    1432 </span>                :            :         //Make these visible on the context so can be called at the very
<span class="lineNum">    1433 </span>                :            :         //end of the file to bootstrap
<span class="lineNum">    1434 </span>                :<span class="lineCov">          1 :         context.jQueryCheck = jQueryCheck;</span>
<span class="lineNum">    1435 </span>                :<span class="lineCov">          1 :         context.resume = resume;</span>
<span class="lineNum">    1436 </span>                :            : 
<span class="lineNum">    1437 </span>                :<span class="lineCov">          1 :         return context;</span>
<span class="lineNum">    1438 </span>                :            :     }
<span class="lineNum">    1439 </span>                :            : 
<span class="lineNum">    1440 </span>                :            :     /**
<span class="lineNum">    1441 </span>                :            :      * Main entry point.
<span class="lineNum">    1442 </span>                :            :      *
<span class="lineNum">    1443 </span>                :            :      * If the only argument to require is a string, then the module that
<span class="lineNum">    1444 </span>                :            :      * is represented by that string is fetched for the appropriate context.
<span class="lineNum">    1445 </span>                :            :      *
<span class="lineNum">    1446 </span>                :            :      * If the first argument is an array, then it will be treated as an array
<span class="lineNum">    1447 </span>                :            :      * of dependency string names to fetch. An optional function callback can
<span class="lineNum">    1448 </span>                :            :      * be specified to execute when all of those dependencies are available.
<span class="lineNum">    1449 </span>                :            :      *
<span class="lineNum">    1450 </span>                :            :      * Make a local req variable to help Caja compliance (it assumes things
<span class="lineNum">    1451 </span>                :            :      * on a require that are not standardized), and to give a short
<span class="lineNum">    1452 </span>                :            :      * name for minification/local scope use.
<span class="lineNum">    1453 </span>                :            :      */
<span class="lineNum">    1454 </span>                :<span class="lineCov">          1 :     req = requirejs = function (deps, callback) {</span>
<span class="lineNum">    1455 </span>                :            : 
<span class="lineNum">    1456 </span>                :            :         //Find the right context, use default
<span class="lineNum">    1457 </span>                :<span class="lineCov">          3 :         var contextName = defContextName,</span>
<span class="lineNum">    1458 </span>                :            :             context, config;
<span class="lineNum">    1459 </span>                :            : 
<span class="lineNum">    1460 </span>                :            :         // Determine if have config object in the call.
<span class="lineNum">    1461 </span>                :<span class="lineCov">          3 :         if (!isArray(deps) &amp;&amp; typeof deps !== &quot;string&quot;) {</span>
<span class="lineNum">    1462 </span>                :            :             // deps is a config object
<span class="lineNum">    1463 </span>                :<span class="lineCov">          1 :             config = deps;</span>
<span class="lineNum">    1464 </span>                :<span class="lineCov">          1 :             if (isArray(callback)) {</span>
<span class="lineNum">    1465 </span>                :            :                 // Adjust args if there are dependencies
<span class="lineNum">    1466 </span>                :<span class="lineNoCov">          0 :                 deps = callback;</span>
<span class="lineNum">    1467 </span>                :<span class="lineNoCov">          0 :                 callback = arguments[2];</span>
<span class="lineNum">    1468 </span>                :            :             } else {
<span class="lineNum">    1469 </span>                :<span class="lineCov">          1 :                 deps = [];</span>
<span class="lineNum">    1470 </span>                :            :             }
<span class="lineNum">    1471 </span>                :            :         }
<span class="lineNum">    1472 </span>                :            : 
<span class="lineNum">    1473 </span>                :<span class="lineCov">          3 :         if (config &amp;&amp; config.context) {</span>
<span class="lineNum">    1474 </span>                :<span class="lineNoCov">          0 :             contextName = config.context;</span>
<span class="lineNum">    1475 </span>                :            :         }
<span class="lineNum">    1476 </span>                :            : 
<span class="lineNum">    1477 </span>                :<span class="lineCov">          3 :         context = contexts[contextName] ||</span>
<span class="lineNum">    1478 </span>                :            :                   (contexts[contextName] = newContext(contextName));
<span class="lineNum">    1479 </span>                :            : 
<span class="lineNum">    1480 </span>                :<span class="lineCov">          3 :         if (config) {</span>
<span class="lineNum">    1481 </span>                :<span class="lineCov">          1 :             context.configure(config);</span>
<span class="lineNum">    1482 </span>                :            :         }
<span class="lineNum">    1483 </span>                :            : 
<span class="lineNum">    1484 </span>                :<span class="lineCov">          3 :         return context.require(deps, callback);</span>
<span class="lineNum">    1485 </span>                :            :     };
<span class="lineNum">    1486 </span>                :            : 
<span class="lineNum">    1487 </span>                :            :     /**
<span class="lineNum">    1488 </span>                :            :      * Support require.config() to make it easier to cooperate with other
<span class="lineNum">    1489 </span>                :            :      * AMD loaders on globally agreed names.
<span class="lineNum">    1490 </span>                :            :      */
<span class="lineNum">    1491 </span>                :<span class="lineCov">          1 :     req.config = function (config) {</span>
<span class="lineNum">    1492 </span>                :<span class="lineNoCov">          0 :         return req(config);</span>
<span class="lineNum">    1493 </span>                :            :     };
<span class="lineNum">    1494 </span>                :            : 
<span class="lineNum">    1495 </span>                :            :     /**
<span class="lineNum">    1496 </span>                :            :      * Export require as a global, but only if it does not already exist.
<span class="lineNum">    1497 </span>                :            :      */
<span class="lineNum">    1498 </span>                :<span class="lineCov">          1 :     if (!require) {</span>
<span class="lineNum">    1499 </span>                :<span class="lineCov">          1 :         require = req;</span>
<span class="lineNum">    1500 </span>                :            :     }
<span class="lineNum">    1501 </span>                :            : 
<span class="lineNum">    1502 </span>                :            :     /**
<span class="lineNum">    1503 </span>                :            :      * Global require.toUrl(), to match global require, mostly useful
<span class="lineNum">    1504 </span>                :            :      * for debugging/work in the global space.
<span class="lineNum">    1505 </span>                :            :      */
<span class="lineNum">    1506 </span>                :<span class="lineCov">          1 :     req.toUrl = function (moduleNamePlusExt) {</span>
<span class="lineNum">    1507 </span>                :<span class="lineNoCov">          0 :         return contexts[defContextName].toUrl(moduleNamePlusExt);</span>
<span class="lineNum">    1508 </span>                :            :     };
<span class="lineNum">    1509 </span>                :            : 
<span class="lineNum">    1510 </span>                :<span class="lineCov">          1 :     req.version = version;</span>
<span class="lineNum">    1511 </span>                :            : 
<span class="lineNum">    1512 </span>                :            :     //Used to filter out dependencies that are already paths.
<span class="lineNum">    1513 </span>                :<span class="lineCov">          1 :     req.jsExtRegExp = /^\/|:|\?|\.js$/;</span>
<span class="lineNum">    1514 </span>                :<span class="lineCov">          1 :     s = req.s = {</span>
<span class="lineNum">    1515 </span>                :            :         contexts: contexts,
<span class="lineNum">    1516 </span>                :            :         //Stores a list of URLs that should not get async script tag treatment.
<span class="lineNum">    1517 </span>                :            :         skipAsync: {}
<span class="lineNum">    1518 </span>                :            :     };
<span class="lineNum">    1519 </span>                :            : 
<span class="lineNum">    1520 </span>                :<span class="lineCov">          1 :     req.isAsync = req.isBrowser = isBrowser;</span>
<span class="lineNum">    1521 </span>                :<span class="lineCov">          1 :     if (isBrowser) {</span>
<span class="lineNum">    1522 </span>                :<span class="lineCov">          1 :         head = s.head = document.getElementsByTagName(&quot;head&quot;)[0];</span>
<span class="lineNum">    1523 </span>                :            :         //If BASE tag is in play, using appendChild is a problem for IE6.
<span class="lineNum">    1524 </span>                :            :         //When that browser dies, this can be removed. Details in this jQuery bug:
<span class="lineNum">    1525 </span>                :            :         //http://dev.jquery.com/ticket/2709
<span class="lineNum">    1526 </span>                :<span class="lineCov">          1 :         baseElement = document.getElementsByTagName(&quot;base&quot;)[0];</span>
<span class="lineNum">    1527 </span>                :<span class="lineCov">          1 :         if (baseElement) {</span>
<span class="lineNum">    1528 </span>                :<span class="lineNoCov">          0 :             head = s.head = baseElement.parentNode;</span>
<span class="lineNum">    1529 </span>                :            :         }
<span class="lineNum">    1530 </span>                :            :     }
<span class="lineNum">    1531 </span>                :            : 
<span class="lineNum">    1532 </span>                :            :     /**
<span class="lineNum">    1533 </span>                :            :      * Any errors that require explicitly generates will be passed to this
<span class="lineNum">    1534 </span>                :            :      * function. Intercept/override it if you want custom error handling.
<span class="lineNum">    1535 </span>                :            :      * @param {Error} err the error object.
<span class="lineNum">    1536 </span>                :            :      */
<span class="lineNum">    1537 </span>                :<span class="lineCov">          1 :     req.onError = function (err) {</span>
<span class="lineNum">    1538 </span>                :<span class="lineCov">          2 :         throw err;</span>
<span class="lineNum">    1539 </span>                :            :     };
<span class="lineNum">    1540 </span>                :            : 
<span class="lineNum">    1541 </span>                :            :     /**
<span class="lineNum">    1542 </span>                :            :      * Does the request to load a module for the browser case.
<span class="lineNum">    1543 </span>                :            :      * Make this a separate function to allow other environments
<span class="lineNum">    1544 </span>                :            :      * to override it.
<span class="lineNum">    1545 </span>                :            :      *
<span class="lineNum">    1546 </span>                :            :      * @param {Object} context the require context to find state.
<span class="lineNum">    1547 </span>                :            :      * @param {String} moduleName the name of the module.
<span class="lineNum">    1548 </span>                :            :      * @param {Object} url the URL to the module.
<span class="lineNum">    1549 </span>                :            :      */
<span class="lineNum">    1550 </span>                :<span class="lineCov">          1 :     req.load = function (context, moduleName, url) {</span>
<span class="lineNum">    1551 </span>                :<span class="lineNoCov">          0 :         req.resourcesReady(false);</span>
<span class="lineNum">    1552 </span>                :            : 
<span class="lineNum">    1553 </span>                :<span class="lineNoCov">          0 :         context.scriptCount += 1;</span>
<span class="lineNum">    1554 </span>                :<span class="lineNoCov">          0 :         req.attach(url, context, moduleName);</span>
<span class="lineNum">    1555 </span>                :            : 
<span class="lineNum">    1556 </span>                :            :         //If tracking a jQuery, then make sure its ready callbacks
<span class="lineNum">    1557 </span>                :            :         //are put on hold to prevent its ready callbacks from
<span class="lineNum">    1558 </span>                :            :         //triggering too soon.
<span class="lineNum">    1559 </span>                :<span class="lineNoCov">          0 :         if (context.jQuery &amp;&amp; !context.jQueryIncremented) {</span>
<span class="lineNum">    1560 </span>                :<span class="lineNoCov">          0 :             jQueryHoldReady(context.jQuery, true);</span>
<span class="lineNum">    1561 </span>                :<span class="lineNoCov">          0 :             context.jQueryIncremented = true;</span>
<span class="lineNum">    1562 </span>                :            :         }
<span class="lineNum">    1563 </span>                :            :     };
<span class="lineNum">    1564 </span>                :            : 
<span class="lineNum">    1565 </span>                :<span class="lineCov">          1 :     function getInteractiveScript() {</span>
<span class="lineNum">    1566 </span>                :<span class="lineNoCov">          0 :         var scripts, i, script;</span>
<span class="lineNum">    1567 </span>                :<span class="lineNoCov">          0 :         if (interactiveScript &amp;&amp; interactiveScript.readyState === 'interactive') {</span>
<span class="lineNum">    1568 </span>                :<span class="lineNoCov">          0 :             return interactiveScript;</span>
<span class="lineNum">    1569 </span>                :            :         }
<span class="lineNum">    1570 </span>                :            : 
<span class="lineNum">    1571 </span>                :<span class="lineNoCov">          0 :         scripts = document.getElementsByTagName('script');</span>
<span class="lineNum">    1572 </span>                :<span class="lineNoCov">          0 :         for (i = scripts.length - 1; i &gt; -1 &amp;&amp; (script = scripts[i]); i--) {</span>
<span class="lineNum">    1573 </span>                :<span class="lineNoCov">          0 :             if (script.readyState === 'interactive') {</span>
<span class="lineNum">    1574 </span>                :<span class="lineNoCov">          0 :                 return (interactiveScript = script);</span>
<span class="lineNum">    1575 </span>                :            :             }
<span class="lineNum">    1576 </span>                :            :         }
<span class="lineNum">    1577 </span>                :            : 
<span class="lineNum">    1578 </span>                :<span class="lineNoCov">          0 :         return null;</span>
<span class="lineNum">    1579 </span>                :            :     }
<span class="lineNum">    1580 </span>                :            : 
<span class="lineNum">    1581 </span>                :            :     /**
<span class="lineNum">    1582 </span>                :            :      * The function that handles definitions of modules. Differs from
<span class="lineNum">    1583 </span>                :            :      * require() in that a string for the module should be the first argument,
<span class="lineNum">    1584 </span>                :            :      * and the function to execute after dependencies are loaded should
<span class="lineNum">    1585 </span>                :            :      * return a value to define the module corresponding to the first argument's
<span class="lineNum">    1586 </span>                :            :      * name.
<span class="lineNum">    1587 </span>                :            :      */
<span class="lineNum">    1588 </span>                :<span class="lineCov">          1 :     define = function (name, deps, callback) {</span>
<span class="lineNum">    1589 </span>                :<span class="lineCov">         15 :         var node, context;</span>
<span class="lineNum">    1590 </span>                :            : 
<span class="lineNum">    1591 </span>                :            :         //Allow for anonymous functions
<span class="lineNum">    1592 </span>                :<span class="lineCov">         15 :         if (typeof name !== 'string') {</span>
<span class="lineNum">    1593 </span>                :            :             //Adjust args appropriately
<span class="lineNum">    1594 </span>                :<span class="lineCov">         14 :             callback = deps;</span>
<span class="lineNum">    1595 </span>                :<span class="lineCov">         14 :             deps = name;</span>
<span class="lineNum">    1596 </span>                :<span class="lineCov">         14 :             name = null;</span>
<span class="lineNum">    1597 </span>                :            :         }
<span class="lineNum">    1598 </span>                :            : 
<span class="lineNum">    1599 </span>                :            :         //This module may not have dependencies
<span class="lineNum">    1600 </span>                :<span class="lineCov">         15 :         if (!isArray(deps)) {</span>
<span class="lineNum">    1601 </span>                :<span class="lineCov">          3 :             callback = deps;</span>
<span class="lineNum">    1602 </span>                :<span class="lineCov">          3 :             deps = [];</span>
<span class="lineNum">    1603 </span>                :            :         }
<span class="lineNum">    1604 </span>                :            : 
<span class="lineNum">    1605 </span>                :            :         //If no name, and callback is a function, then figure out if it a
<span class="lineNum">    1606 </span>                :            :         //CommonJS thing with dependencies.
<span class="lineNum">    1607 </span>                :<span class="lineCov">         15 :         if (!deps.length &amp;&amp; isFunction(callback)) {</span>
<span class="lineNum">    1608 </span>                :            :             //Remove comments from the callback string,
<span class="lineNum">    1609 </span>                :            :             //look for require calls, and pull them into the dependencies,
<span class="lineNum">    1610 </span>                :            :             //but only if there are function args.
<span class="lineNum">    1611 </span>                :<span class="lineCov">          5 :             if (callback.length) {</span>
<span class="lineNum">    1612 </span>                :<span class="lineNoCov">          0 :                 callback</span>
<span class="lineNum">    1613 </span>                :            :                     .toString()
<span class="lineNum">    1614 </span>                :            :                     .replace(commentRegExp, &quot;&quot;)
<span class="lineNum">    1615 </span>                :            :                     .replace(cjsRequireRegExp, function (match, dep) {
<span class="lineNum">    1616 </span>                :<span class="lineNoCov">          0 :                         deps.push(dep);</span>
<span class="lineNum">    1617 </span>                :            :                     });
<span class="lineNum">    1618 </span>                :            : 
<span class="lineNum">    1619 </span>                :            :                 //May be a CommonJS thing even without require calls, but still
<span class="lineNum">    1620 </span>                :            :                 //could use exports, and module. Avoid doing exports and module
<span class="lineNum">    1621 </span>                :            :                 //work though if it just needs require.
<span class="lineNum">    1622 </span>                :            :                 //REQUIRES the function to expect the CommonJS variables in the
<span class="lineNum">    1623 </span>                :            :                 //order listed below.
<span class="lineNum">    1624 </span>                :<span class="lineNoCov">          0 :                 deps = (callback.length === 1 ? [&quot;require&quot;] : [&quot;require&quot;, &quot;exports&quot;, &quot;module&quot;]).concat(deps);</span>
<span class="lineNum">    1625 </span>                :            :             }
<span class="lineNum">    1626 </span>                :            :         }
<span class="lineNum">    1627 </span>                :            : 
<span class="lineNum">    1628 </span>                :            :         //If in IE 6-8 and hit an anonymous define() call, do the interactive
<span class="lineNum">    1629 </span>                :            :         //work.
<span class="lineNum">    1630 </span>                :<span class="lineCov">         15 :         if (useInteractive) {</span>
<span class="lineNum">    1631 </span>                :<span class="lineNoCov">          0 :             node = currentlyAddingScript || getInteractiveScript();</span>
<span class="lineNum">    1632 </span>                :<span class="lineNoCov">          0 :             if (node) {</span>
<span class="lineNum">    1633 </span>                :<span class="lineNoCov">          0 :                 if (!name) {</span>
<span class="lineNum">    1634 </span>                :<span class="lineNoCov">          0 :                     name = node.getAttribute(&quot;data-requiremodule&quot;);</span>
<span class="lineNum">    1635 </span>                :            :                 }
<span class="lineNum">    1636 </span>                :<span class="lineNoCov">          0 :                 context = contexts[node.getAttribute(&quot;data-requirecontext&quot;)];</span>
<span class="lineNum">    1637 </span>                :            :             }
<span class="lineNum">    1638 </span>                :            :         }
<span class="lineNum">    1639 </span>                :            : 
<span class="lineNum">    1640 </span>                :            :         //Always save off evaluating the def call until the script onload handler.
<span class="lineNum">    1641 </span>                :            :         //This allows multiple modules to be in a file without prematurely
<span class="lineNum">    1642 </span>                :            :         //tracing dependencies, and allows for anonymous module support,
<span class="lineNum">    1643 </span>                :            :         //where the module name is not known until the script onload event
<span class="lineNum">    1644 </span>                :            :         //occurs. If no context, use the global queue, and get it processed
<span class="lineNum">    1645 </span>                :            :         //in the onscript load callback.
<span class="lineNum">    1646 </span>                :<span class="lineCov">         15 :         (context ? context.defQueue : globalDefQueue).push([name, deps, callback]);</span>
<span class="lineNum">    1647 </span>                :            : 
<span class="lineNum">    1648 </span>                :<span class="lineCov">         15 :         return undefined;</span>
<span class="lineNum">    1649 </span>                :            :     };
<span class="lineNum">    1650 </span>                :            : 
<span class="lineNum">    1651 </span>                :<span class="lineCov">          1 :     define.amd = {</span>
<span class="lineNum">    1652 </span>                :            :         multiversion: true,
<span class="lineNum">    1653 </span>                :            :         plugins: true,
<span class="lineNum">    1654 </span>                :            :         jQuery: true
<span class="lineNum">    1655 </span>                :            :     };
<span class="lineNum">    1656 </span>                :            : 
<span class="lineNum">    1657 </span>                :            :     /**
<span class="lineNum">    1658 </span>                :            :      * Executes the text. Normally just uses eval, but can be modified
<span class="lineNum">    1659 </span>                :            :      * to use a more environment specific call.
<span class="lineNum">    1660 </span>                :            :      * @param {String} text the text to execute/evaluate.
<span class="lineNum">    1661 </span>                :            :      */
<span class="lineNum">    1662 </span>                :<span class="lineCov">          1 :     req.exec = function (text) {</span>
<span class="lineNum">    1663 </span>                :<span class="lineNoCov">          0 :         return eval(text);</span>
<span class="lineNum">    1664 </span>                :            :     };
<span class="lineNum">    1665 </span>                :            : 
<span class="lineNum">    1666 </span>                :            :     /**
<span class="lineNum">    1667 </span>                :            :      * Executes a module callack function. Broken out as a separate function
<span class="lineNum">    1668 </span>                :            :      * solely to allow the build system to sequence the files in the built
<span class="lineNum">    1669 </span>                :            :      * layer in the right sequence.
<span class="lineNum">    1670 </span>                :            :      *
<span class="lineNum">    1671 </span>                :            :      * @private
<span class="lineNum">    1672 </span>                :            :      */
<span class="lineNum">    1673 </span>                :<span class="lineCov">          1 :     req.execCb = function (name, callback, args, exports) {</span>
<span class="lineNum">    1674 </span>                :<span class="lineCov">          2 :         return callback.apply(exports, args);</span>
<span class="lineNum">    1675 </span>                :            :     };
<span class="lineNum">    1676 </span>                :            : 
<span class="lineNum">    1677 </span>                :            : 
<span class="lineNum">    1678 </span>                :            :     /**
<span class="lineNum">    1679 </span>                :            :      * Adds a node to the DOM. Public function since used by the order plugin.
<span class="lineNum">    1680 </span>                :            :      * This method should not normally be called by outside code.
<span class="lineNum">    1681 </span>                :            :      */
<span class="lineNum">    1682 </span>                :<span class="lineCov">          1 :     req.addScriptToDom = function (node) {</span>
<span class="lineNum">    1683 </span>                :            :         //For some cache cases in IE 6-8, the script executes before the end
<span class="lineNum">    1684 </span>                :            :         //of the appendChild execution, so to tie an anonymous define
<span class="lineNum">    1685 </span>                :            :         //call to the module name (which is stored on the node), hold on
<span class="lineNum">    1686 </span>                :            :         //to a reference to this node, but clear after the DOM insertion.
<span class="lineNum">    1687 </span>                :<span class="lineNoCov">          0 :         currentlyAddingScript = node;</span>
<span class="lineNum">    1688 </span>                :<span class="lineNoCov">          0 :         if (baseElement) {</span>
<span class="lineNum">    1689 </span>                :<span class="lineNoCov">          0 :             head.insertBefore(node, baseElement);</span>
<span class="lineNum">    1690 </span>                :            :         } else {
<span class="lineNum">    1691 </span>                :<span class="lineNoCov">          0 :             head.appendChild(node);</span>
<span class="lineNum">    1692 </span>                :            :         }
<span class="lineNum">    1693 </span>                :<span class="lineNoCov">          0 :         currentlyAddingScript = null;</span>
<span class="lineNum">    1694 </span>                :            :     };
<span class="lineNum">    1695 </span>                :            : 
<span class="lineNum">    1696 </span>                :            :     /**
<span class="lineNum">    1697 </span>                :            :      * callback for script loads, used to check status of loading.
<span class="lineNum">    1698 </span>                :            :      *
<span class="lineNum">    1699 </span>                :            :      * @param {Event} evt the event from the browser for the script
<span class="lineNum">    1700 </span>                :            :      * that was loaded.
<span class="lineNum">    1701 </span>                :            :      *
<span class="lineNum">    1702 </span>                :            :      * @private
<span class="lineNum">    1703 </span>                :            :      */
<span class="lineNum">    1704 </span>                :<span class="lineCov">          1 :     req.onScriptLoad = function (evt) {</span>
<span class="lineNum">    1705 </span>                :            :         //Using currentTarget instead of target for Firefox 2.0's sake. Not
<span class="lineNum">    1706 </span>                :            :         //all old browsers will be supported, but this one was easy enough
<span class="lineNum">    1707 </span>                :            :         //to support and still makes sense.
<span class="lineNum">    1708 </span>                :<span class="lineNoCov">          0 :         var node = evt.currentTarget || evt.srcElement, contextName, moduleName,</span>
<span class="lineNum">    1709 </span>                :            :             context;
<span class="lineNum">    1710 </span>                :            : 
<span class="lineNum">    1711 </span>                :<span class="lineNoCov">          0 :         if (evt.type === &quot;load&quot; || (node &amp;&amp; readyRegExp.test(node.readyState))) {</span>
<span class="lineNum">    1712 </span>                :            :             //Reset interactive script so a script node is not held onto for
<span class="lineNum">    1713 </span>                :            :             //to long.
<span class="lineNum">    1714 </span>                :<span class="lineNoCov">          0 :             interactiveScript = null;</span>
<span class="lineNum">    1715 </span>                :            : 
<span class="lineNum">    1716 </span>                :            :             //Pull out the name of the module and the context.
<span class="lineNum">    1717 </span>                :<span class="lineNoCov">          0 :             contextName = node.getAttribute(&quot;data-requirecontext&quot;);</span>
<span class="lineNum">    1718 </span>                :<span class="lineNoCov">          0 :             moduleName = node.getAttribute(&quot;data-requiremodule&quot;);</span>
<span class="lineNum">    1719 </span>                :<span class="lineNoCov">          0 :             context = contexts[contextName];</span>
<span class="lineNum">    1720 </span>                :            : 
<span class="lineNum">    1721 </span>                :<span class="lineNoCov">          0 :             contexts[contextName].completeLoad(moduleName);</span>
<span class="lineNum">    1722 </span>                :            : 
<span class="lineNum">    1723 </span>                :            :             //Clean up script binding. Favor detachEvent because of IE9
<span class="lineNum">    1724 </span>                :            :             //issue, see attachEvent/addEventListener comment elsewhere
<span class="lineNum">    1725 </span>                :            :             //in this file.
<span class="lineNum">    1726 </span>                :<span class="lineNoCov">          0 :             if (node.detachEvent &amp;&amp; !isOpera) {</span>
<span class="lineNum">    1727 </span>                :            :                 //Probably IE. If not it will throw an error, which will be
<span class="lineNum">    1728 </span>                :            :                 //useful to know.
<span class="lineNum">    1729 </span>                :<span class="lineNoCov">          0 :                 node.detachEvent(&quot;onreadystatechange&quot;, req.onScriptLoad);</span>
<span class="lineNum">    1730 </span>                :            :             } else {
<span class="lineNum">    1731 </span>                :<span class="lineNoCov">          0 :                 node.removeEventListener(&quot;load&quot;, req.onScriptLoad, false);</span>
<span class="lineNum">    1732 </span>                :            :             }
<span class="lineNum">    1733 </span>                :            :         }
<span class="lineNum">    1734 </span>                :            :     };
<span class="lineNum">    1735 </span>                :            : 
<span class="lineNum">    1736 </span>                :            :     /**
<span class="lineNum">    1737 </span>                :            :      * Attaches the script represented by the URL to the current
<span class="lineNum">    1738 </span>                :            :      * environment. Right now only supports browser loading,
<span class="lineNum">    1739 </span>                :            :      * but can be redefined in other environments to do the right thing.
<span class="lineNum">    1740 </span>                :            :      * @param {String} url the url of the script to attach.
<span class="lineNum">    1741 </span>                :            :      * @param {Object} context the context that wants the script.
<span class="lineNum">    1742 </span>                :            :      * @param {moduleName} the name of the module that is associated with the script.
<span class="lineNum">    1743 </span>                :            :      * @param {Function} [callback] optional callback, defaults to require.onScriptLoad
<span class="lineNum">    1744 </span>                :            :      * @param {String} [type] optional type, defaults to text/javascript
<span class="lineNum">    1745 </span>                :            :      * @param {Function} [fetchOnlyFunction] optional function to indicate the script node
<span class="lineNum">    1746 </span>                :            :      * should be set up to fetch the script but do not attach it to the DOM
<span class="lineNum">    1747 </span>                :            :      * so that it can later be attached to execute it. This is a way for the
<span class="lineNum">    1748 </span>                :            :      * order plugin to support ordered loading in IE. Once the script is fetched,
<span class="lineNum">    1749 </span>                :            :      * but not executed, the fetchOnlyFunction will be called.
<span class="lineNum">    1750 </span>                :            :      */
<span class="lineNum">    1751 </span>                :<span class="lineCov">          1 :     req.attach = function (url, context, moduleName, callback, type, fetchOnlyFunction) {</span>
<span class="lineNum">    1752 </span>                :<span class="lineNoCov">          0 :         var node;</span>
<span class="lineNum">    1753 </span>                :<span class="lineNoCov">          0 :         if (isBrowser) {</span>
<span class="lineNum">    1754 </span>                :            :             //In the browser so use a script tag
<span class="lineNum">    1755 </span>                :<span class="lineNoCov">          0 :             callback = callback || req.onScriptLoad;</span>
<span class="lineNum">    1756 </span>                :<span class="lineNoCov">          0 :             node = context &amp;&amp; context.config &amp;&amp; context.config.xhtml ?</span>
<span class="lineNum">    1757 </span>                :            :                     document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;html:script&quot;) :
<span class="lineNum">    1758 </span>                :            :                     document.createElement(&quot;script&quot;);
<span class="lineNum">    1759 </span>                :<span class="lineNoCov">          0 :             node.type = type || (context &amp;&amp; context.config.scriptType) ||</span>
<span class="lineNum">    1760 </span>                :            :                         &quot;text/javascript&quot;;
<span class="lineNum">    1761 </span>                :<span class="lineNoCov">          0 :             node.charset = &quot;utf-8&quot;;</span>
<span class="lineNum">    1762 </span>                :            :             //Use async so Gecko does not block on executing the script if something
<span class="lineNum">    1763 </span>                :            :             //like a long-polling comet tag is being run first. Gecko likes
<span class="lineNum">    1764 </span>                :            :             //to evaluate scripts in DOM order, even for dynamic scripts.
<span class="lineNum">    1765 </span>                :            :             //It will fetch them async, but only evaluate the contents in DOM
<span class="lineNum">    1766 </span>                :            :             //order, so a long-polling script tag can delay execution of scripts
<span class="lineNum">    1767 </span>                :            :             //after it. But telling Gecko we expect async gets us the behavior
<span class="lineNum">    1768 </span>                :            :             //we want -- execute it whenever it is finished downloading. Only
<span class="lineNum">    1769 </span>                :            :             //Helps Firefox 3.6+
<span class="lineNum">    1770 </span>                :            :             //Allow some URLs to not be fetched async. Mostly helps the order!
<span class="lineNum">    1771 </span>                :            :             //plugin
<span class="lineNum">    1772 </span>                :<span class="lineNoCov">          0 :             node.async = !s.skipAsync[url];</span>
<span class="lineNum">    1773 </span>                :            : 
<span class="lineNum">    1774 </span>                :<span class="lineNoCov">          0 :             if (context) {</span>
<span class="lineNum">    1775 </span>                :<span class="lineNoCov">          0 :                 node.setAttribute(&quot;data-requirecontext&quot;, context.contextName);</span>
<span class="lineNum">    1776 </span>                :            :             }
<span class="lineNum">    1777 </span>                :<span class="lineNoCov">          0 :             node.setAttribute(&quot;data-requiremodule&quot;, moduleName);</span>
<span class="lineNum">    1778 </span>                :            : 
<span class="lineNum">    1779 </span>                :            :             //Set up load listener. Test attachEvent first because IE9 has
<span class="lineNum">    1780 </span>                :            :             //a subtle issue in its addEventListener and script onload firings
<span class="lineNum">    1781 </span>                :            :             //that do not match the behavior of all other browsers with
<span class="lineNum">    1782 </span>                :            :             //addEventListener support, which fire the onload event for a
<span class="lineNum">    1783 </span>                :            :             //script right after the script execution. See:
<span class="lineNum">    1784 </span>                :            :             //https://connect.microsoft.com/IE/feedback/details/648057/script-onload-event-is-not-fired-immediately-after-script-execution
<span class="lineNum">    1785 </span>                :            :             //UNFORTUNATELY Opera implements attachEvent but does not follow the script
<span class="lineNum">    1786 </span>                :            :             //script execution mode.
<span class="lineNum">    1787 </span>                :<span class="lineNoCov">          0 :             if (node.attachEvent &amp;&amp; !isOpera) {</span>
<span class="lineNum">    1788 </span>                :            :                 //Probably IE. IE (at least 6-8) do not fire
<span class="lineNum">    1789 </span>                :            :                 //script onload right after executing the script, so
<span class="lineNum">    1790 </span>                :            :                 //we cannot tie the anonymous define call to a name.
<span class="lineNum">    1791 </span>                :            :                 //However, IE reports the script as being in &quot;interactive&quot;
<span class="lineNum">    1792 </span>                :            :                 //readyState at the time of the define call.
<span class="lineNum">    1793 </span>                :<span class="lineNoCov">          0 :                 useInteractive = true;</span>
<span class="lineNum">    1794 </span>                :            : 
<span class="lineNum">    1795 </span>                :            : 
<span class="lineNum">    1796 </span>                :<span class="lineNoCov">          0 :                 if (fetchOnlyFunction) {</span>
<span class="lineNum">    1797 </span>                :            :                     //Need to use old school onreadystate here since
<span class="lineNum">    1798 </span>                :            :                     //when the event fires and the node is not attached
<span class="lineNum">    1799 </span>                :            :                     //to the DOM, the evt.srcElement is null, so use
<span class="lineNum">    1800 </span>                :            :                     //a closure to remember the node.
<span class="lineNum">    1801 </span>                :<span class="lineNoCov">          0 :                     node.onreadystatechange = function (evt) {</span>
<span class="lineNum">    1802 </span>                :            :                         //Script loaded but not executed.
<span class="lineNum">    1803 </span>                :            :                         //Clear loaded handler, set the real one that
<span class="lineNum">    1804 </span>                :            :                         //waits for script execution.
<span class="lineNum">    1805 </span>                :<span class="lineNoCov">          0 :                         if (node.readyState === 'loaded') {</span>
<span class="lineNum">    1806 </span>                :<span class="lineNoCov">          0 :                             node.onreadystatechange = null;</span>
<span class="lineNum">    1807 </span>                :<span class="lineNoCov">          0 :                             node.attachEvent(&quot;onreadystatechange&quot;, callback);</span>
<span class="lineNum">    1808 </span>                :<span class="lineNoCov">          0 :                             fetchOnlyFunction(node);</span>
<span class="lineNum">    1809 </span>                :            :                         }
<span class="lineNum">    1810 </span>                :            :                     };
<span class="lineNum">    1811 </span>                :            :                 } else {
<span class="lineNum">    1812 </span>                :<span class="lineNoCov">          0 :                     node.attachEvent(&quot;onreadystatechange&quot;, callback);</span>
<span class="lineNum">    1813 </span>                :            :                 }
<span class="lineNum">    1814 </span>                :            :             } else {
<span class="lineNum">    1815 </span>                :<span class="lineNoCov">          0 :                 node.addEventListener(&quot;load&quot;, callback, false);</span>
<span class="lineNum">    1816 </span>                :            :             }
<span class="lineNum">    1817 </span>                :<span class="lineNoCov">          0 :             node.src = url;</span>
<span class="lineNum">    1818 </span>                :            : 
<span class="lineNum">    1819 </span>                :            :             //Fetch only means waiting to attach to DOM after loaded.
<span class="lineNum">    1820 </span>                :<span class="lineNoCov">          0 :             if (!fetchOnlyFunction) {</span>
<span class="lineNum">    1821 </span>                :<span class="lineNoCov">          0 :                 req.addScriptToDom(node);</span>
<span class="lineNum">    1822 </span>                :            :             }
<span class="lineNum">    1823 </span>                :            : 
<span class="lineNum">    1824 </span>                :<span class="lineNoCov">          0 :             return node;</span>
<span class="lineNum">    1825 </span>                :<span class="lineNoCov">          0 :         } else if (isWebWorker) {</span>
<span class="lineNum">    1826 </span>                :            :             //In a web worker, use importScripts. This is not a very
<span class="lineNum">    1827 </span>                :            :             //efficient use of importScripts, importScripts will block until
<span class="lineNum">    1828 </span>                :            :             //its script is downloaded and evaluated. However, if web workers
<span class="lineNum">    1829 </span>                :            :             //are in play, the expectation that a build has been done so that
<span class="lineNum">    1830 </span>                :            :             //only one script needs to be loaded anyway. This may need to be
<span class="lineNum">    1831 </span>                :            :             //reevaluated if other use cases become common.
<span class="lineNum">    1832 </span>                :<span class="lineNoCov">          0 :             importScripts(url);</span>
<span class="lineNum">    1833 </span>                :            : 
<span class="lineNum">    1834 </span>                :            :             //Account for anonymous modules
<span class="lineNum">    1835 </span>                :<span class="lineNoCov">          0 :             context.completeLoad(moduleName);</span>
<span class="lineNum">    1836 </span>                :            :         }
<span class="lineNum">    1837 </span>                :<span class="lineNoCov">          0 :         return null;</span>
<span class="lineNum">    1838 </span>                :            :     };
<span class="lineNum">    1839 </span>                :            : 
<span class="lineNum">    1840 </span>                :            :     //Look for a data-main script attribute, which could also adjust the baseUrl.
<span class="lineNum">    1841 </span>                :<span class="lineCov">          1 :     if (isBrowser) {</span>
<span class="lineNum">    1842 </span>                :            :         //Figure out baseUrl. Get it from the script tag with require.js in it.
<span class="lineNum">    1843 </span>                :<span class="lineCov">          1 :         scripts = document.getElementsByTagName(&quot;script&quot;);</span>
<span class="lineNum">    1844 </span>                :            : 
<span class="lineNum">    1845 </span>                :<span class="lineCov">          1 :         for (i = scripts.length - 1; i &gt; -1 &amp;&amp; (script = scripts[i]); i--) {</span>
<span class="lineNum">    1846 </span>                :            :             //Set the &quot;head&quot; where we can append children by
<span class="lineNum">    1847 </span>                :            :             //using the script's parent.
<span class="lineNum">    1848 </span>                :<span class="lineCov">         16 :             if (!head) {</span>
<span class="lineNum">    1849 </span>                :<span class="lineNoCov">          0 :                 head = script.parentNode;</span>
<span class="lineNum">    1850 </span>                :            :             }
<span class="lineNum">    1851 </span>                :            : 
<span class="lineNum">    1852 </span>                :            :             //Look for a data-main attribute to set main script for the page
<span class="lineNum">    1853 </span>                :            :             //to load. If it is there, the path to data main becomes the
<span class="lineNum">    1854 </span>                :            :             //baseUrl, if it is not already set.
<span class="lineNum">    1855 </span>                :<span class="lineCov">         16 :             if ((dataMain = script.getAttribute('data-main'))) {</span>
<span class="lineNum">    1856 </span>                :<span class="lineNoCov">          0 :                 if (!cfg.baseUrl) {</span>
<span class="lineNum">    1857 </span>                :            :                     //Pull off the directory of data-main for use as the
<span class="lineNum">    1858 </span>                :            :                     //baseUrl.
<span class="lineNum">    1859 </span>                :<span class="lineNoCov">          0 :                     src = dataMain.split('/');</span>
<span class="lineNum">    1860 </span>                :<span class="lineNoCov">          0 :                     mainScript = src.pop();</span>
<span class="lineNum">    1861 </span>                :<span class="lineNoCov">          0 :                     subPath = src.length ? src.join('/')  + '/' : './';</span>
<span class="lineNum">    1862 </span>                :            : 
<span class="lineNum">    1863 </span>                :            :                     //Set final config.
<span class="lineNum">    1864 </span>                :<span class="lineNoCov">          0 :                     cfg.baseUrl = subPath;</span>
<span class="lineNum">    1865 </span>                :            :                     //Strip off any trailing .js since dataMain is now
<span class="lineNum">    1866 </span>                :            :                     //like a module name.
<span class="lineNum">    1867 </span>                :<span class="lineNoCov">          0 :                     dataMain = mainScript.replace(jsSuffixRegExp, '');</span>
<span class="lineNum">    1868 </span>                :            :                 }
<span class="lineNum">    1869 </span>                :            : 
<span class="lineNum">    1870 </span>                :            :                 //Put the data-main script in the files to load.
<span class="lineNum">    1871 </span>                :<span class="lineNoCov">          0 :                 cfg.deps = cfg.deps ? cfg.deps.concat(dataMain) : [dataMain];</span>
<span class="lineNum">    1872 </span>                :            : 
<span class="lineNum">    1873 </span>                :<span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1874 </span>                :            :             }
<span class="lineNum">    1875 </span>                :            :         }
<span class="lineNum">    1876 </span>                :            :     }
<span class="lineNum">    1877 </span>                :            : 
<span class="lineNum">    1878 </span>                :            :     //See if there is nothing waiting across contexts, and if not, trigger
<span class="lineNum">    1879 </span>                :            :     //resourcesReady.
<span class="lineNum">    1880 </span>                :<span class="lineCov">          1 :     req.checkReadyState = function () {</span>
<span class="lineNum">    1881 </span>                :<span class="lineCov">          1 :         var contexts = s.contexts, prop;</span>
<span class="lineNum">    1882 </span>                :<span class="lineCov">          1 :         for (prop in contexts) {</span>
<span class="lineNum">    1883 </span>                :<span class="lineCov">          1 :             if (!(prop in empty)) {</span>
<span class="lineNum">    1884 </span>                :<span class="lineCov">          1 :                 if (contexts[prop].waitCount) {</span>
<span class="lineNum">    1885 </span>                :<span class="lineNoCov">          0 :                     return;</span>
<span class="lineNum">    1886 </span>                :            :                 }
<span class="lineNum">    1887 </span>                :            :             }
<span class="lineNum">    1888 </span>                :            :         }
<span class="lineNum">    1889 </span>                :<span class="lineCov">          1 :         req.resourcesReady(true);</span>
<span class="lineNum">    1890 </span>                :            :     };
<span class="lineNum">    1891 </span>                :            : 
<span class="lineNum">    1892 </span>                :            :     /**
<span class="lineNum">    1893 </span>                :            :      * Internal function that is triggered whenever all scripts/resources
<span class="lineNum">    1894 </span>                :            :      * have been loaded by the loader. Can be overridden by other, for
<span class="lineNum">    1895 </span>                :            :      * instance the domReady plugin, which wants to know when all resources
<span class="lineNum">    1896 </span>                :            :      * are loaded.
<span class="lineNum">    1897 </span>                :            :      */
<span class="lineNum">    1898 </span>                :<span class="lineCov">          1 :     req.resourcesReady = function (isReady) {</span>
<span class="lineNum">    1899 </span>                :<span class="lineCov">          1 :         var contexts, context, prop;</span>
<span class="lineNum">    1900 </span>                :            : 
<span class="lineNum">    1901 </span>                :            :         //First, set the public variable indicating that resources are loading.
<span class="lineNum">    1902 </span>                :<span class="lineCov">          1 :         req.resourcesDone = isReady;</span>
<span class="lineNum">    1903 </span>                :            : 
<span class="lineNum">    1904 </span>                :<span class="lineCov">          1 :         if (req.resourcesDone) {</span>
<span class="lineNum">    1905 </span>                :            :             //If jQuery with DOM ready delayed, release it now.
<span class="lineNum">    1906 </span>                :<span class="lineCov">          1 :             contexts = s.contexts;</span>
<span class="lineNum">    1907 </span>                :<span class="lineCov">          1 :             for (prop in contexts) {</span>
<span class="lineNum">    1908 </span>                :<span class="lineCov">          1 :                 if (!(prop in empty)) {</span>
<span class="lineNum">    1909 </span>                :<span class="lineCov">          1 :                     context = contexts[prop];</span>
<span class="lineNum">    1910 </span>                :<span class="lineCov">          1 :                     if (context.jQueryIncremented) {</span>
<span class="lineNum">    1911 </span>                :<span class="lineNoCov">          0 :                         jQueryHoldReady(context.jQuery, false);</span>
<span class="lineNum">    1912 </span>                :<span class="lineNoCov">          0 :                         context.jQueryIncremented = false;</span>
<span class="lineNum">    1913 </span>                :            :                     }
<span class="lineNum">    1914 </span>                :            :                 }
<span class="lineNum">    1915 </span>                :            :             }
<span class="lineNum">    1916 </span>                :            :         }
<span class="lineNum">    1917 </span>                :            :     };
<span class="lineNum">    1918 </span>                :            : 
<span class="lineNum">    1919 </span>                :            :     //FF &lt; 3.6 readyState fix. Needed so that domReady plugin
<span class="lineNum">    1920 </span>                :            :     //works well in that environment, since require.js is normally
<span class="lineNum">    1921 </span>                :            :     //loaded via an HTML script tag so it will be there before window load,
<span class="lineNum">    1922 </span>                :            :     //where the domReady plugin is more likely to be loaded after window load.
<span class="lineNum">    1923 </span>                :<span class="lineCov">          1 :     req.pageLoaded = function () {</span>
<span class="lineNum">    1924 </span>                :<span class="lineNoCov">          0 :         if (document.readyState !== &quot;complete&quot;) {</span>
<span class="lineNum">    1925 </span>                :<span class="lineNoCov">          0 :             document.readyState = &quot;complete&quot;;</span>
<span class="lineNum">    1926 </span>                :            :         }
<span class="lineNum">    1927 </span>                :            :     };
<span class="lineNum">    1928 </span>                :<span class="lineCov">          1 :     if (isBrowser) {</span>
<span class="lineNum">    1929 </span>                :<span class="lineCov">          1 :         if (document.addEventListener) {</span>
<span class="lineNum">    1930 </span>                :<span class="lineCov">          1 :             if (!document.readyState) {</span>
<span class="lineNum">    1931 </span>                :<span class="lineNoCov">          0 :                 document.readyState = &quot;loading&quot;;</span>
<span class="lineNum">    1932 </span>                :<span class="lineNoCov">          0 :                 window.addEventListener(&quot;load&quot;, req.pageLoaded, false);</span>
<span class="lineNum">    1933 </span>                :            :             }
<span class="lineNum">    1934 </span>                :            :         }
<span class="lineNum">    1935 </span>                :            :     }
<span class="lineNum">    1936 </span>                :            : 
<span class="lineNum">    1937 </span>                :            :     //Set up default context. If require was a configuration object, use that as base config.
<span class="lineNum">    1938 </span>                :<span class="lineCov">          1 :     req(cfg);</span>
<span class="lineNum">    1939 </span>                :            : 
<span class="lineNum">    1940 </span>                :            :     //If modules are built into require.js, then need to make sure dependencies are
<span class="lineNum">    1941 </span>                :            :     //traced. Use a setTimeout in the browser world, to allow all the modules to register
<span class="lineNum">    1942 </span>                :            :     //themselves. In a non-browser env, assume that modules are not built into require.js,
<span class="lineNum">    1943 </span>                :            :     //which seems odd to do on the server.
<span class="lineNum">    1944 </span>                :<span class="lineCov">          1 :     if (req.isAsync &amp;&amp; typeof setTimeout !== &quot;undefined&quot;) {</span>
<span class="lineNum">    1945 </span>                :<span class="lineCov">          1 :         ctx = s.contexts[(cfg.context || defContextName)];</span>
<span class="lineNum">    1946 </span>                :            :         //Indicate that the script that includes require() is still loading,
<span class="lineNum">    1947 </span>                :            :         //so that require()'d dependencies are not traced until the end of the
<span class="lineNum">    1948 </span>                :            :         //file is parsed (approximated via the setTimeout call).
<span class="lineNum">    1949 </span>                :<span class="lineCov">          1 :         ctx.requireWait = true;</span>
<span class="lineNum">    1950 </span>                :<span class="lineCov">          1 :         setTimeout(function () {</span>
<span class="lineNum">    1951 </span>                :<span class="lineCov">          1 :             ctx.requireWait = false;</span>
<span class="lineNum">    1952 </span>                :            : 
<span class="lineNum">    1953 </span>                :            :             //Any modules included with the require.js file will be in the
<span class="lineNum">    1954 </span>                :            :             //global queue, assign them to this context.
<span class="lineNum">    1955 </span>                :<span class="lineCov">          1 :             ctx.takeGlobalQueue();</span>
<span class="lineNum">    1956 </span>                :            : 
<span class="lineNum">    1957 </span>                :<span class="lineCov">          1 :             if (!ctx.scriptCount) {</span>
<span class="lineNum">    1958 </span>                :<span class="lineCov">          1 :                 ctx.resume();</span>
<span class="lineNum">    1959 </span>                :            :             }
<span class="lineNum">    1960 </span>                :<span class="lineCov">          1 :             req.checkReadyState();</span>
<span class="lineNum">    1961 </span>                :            :         }, 0);
<span class="lineNum">    1962 </span>                :            :     }
<span class="lineNum">    1963 </span>                :            : }());
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.9</a></td></tr>
  </table>
  <br>

</body>
</html>
